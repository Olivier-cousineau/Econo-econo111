<!DOCTYPE html>
<html lang="en" data-page="landing">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EconoDeal ‚Äî Canada</title>
  <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body class="overlay-active">
  <div class="bg-visuals" aria-hidden="true">
    <div class="bg-grid"></div>
    <div class="bg-orb bg-orb--one"></div>
    <div class="bg-orb bg-orb--two"></div>
    <div class="bg-orb bg-orb--three"></div>
  </div>
  <div id="registrationOverlay" role="dialog" aria-modal="true" aria-labelledby="registrationTitle">
    <div class="registration-card">
      <h2 id="registrationTitle">Members-only access</h2>
      <p class="muted" style="margin:0">Join <strong><span data-client-count>0</span></strong> Amazon resellers and deal hunters, then unlock the full catalogue.</p>
      <form id="registrationForm">
        <div>
          <label for="fullName">Full name</label>
          <input id="fullName" name="fullName" type="text" placeholder="Enter your name" autocomplete="name" required />
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" name="email" type="email" placeholder="name@example.com" autocomplete="email" required />
        </div>
        <div class="checkbox-row">
          <input id="regulationCheckbox" name="regulation" type="checkbox" required />
          <label for="regulationCheckbox" style="margin:0">I confirm I have read and accepted the site usage guidelines.</label>
        </div>
        <button id="registrationSubmit" type="submit" disabled>Sign up and unlock access</button>
      </form>
    </div>
  </div>
  <header>
    <div class="container header-layout">
      <div class="row header-top">
        <div class="row" style="gap:16px;align-items:center;flex-wrap:wrap">
          <a class="brand" href="index-en.html">
            <img src="assets/logo.svg" alt="EconoDeal ‚Äì Amazon sellers accelerator" />
            <span class="brand-text">
              <span class="brand-title">EconoDeal</span>
              <span class="brand-tagline">Your Amazon hub</span>
            </span>
          </a>
          <div class="country-toggle country-toggle--header" role="group" aria-label="Select country">
            <button type="button" class="country-button active" data-country="canada" aria-pressed="true">Canada</button>
            <button type="button" class="country-button" data-country="usa" aria-pressed="false">United States</button>
            <button type="button" class="country-button" data-country="europe" aria-pressed="false">Europe</button>
          </div>
        </div>
        <div class="row" style="gap:12px;align-items:center">
          <a class="nav-button" href="best-deals-en.html" style="white-space:nowrap">Top deals</a>
          <a class="nav-button" href="pricing-en.html" style="white-space:nowrap">Plans / pricing</a>
          <a class="nav-button" href="roadmap-en.html" style="white-space:nowrap">Roadmap / vision</a>
          <div class="lang-switch" aria-label="Language selector">
            <a href="index.html">FR</a>
            <span class="active" aria-current="true">EN</span>
            <a href="index-es.html">ES</a>
            <a href="index-de.html">DE</a>
            <a href="index-it.html">IT</a>
          </div>
          <span class="header-region" data-exchange-indicator aria-live="polite" aria-label="Exchange rate 1 CAD to 1 CAD">1 CAD = 1 CAD</span>
          <div class="muted" style="white-space:nowrap">Registered clients:&nbsp; <span data-client-count>0</span></div>
          <div class="muted">¬© <span id="year"></span></div>
        </div>
      </div>
      <aside id="storeAds" class="store-ads" aria-live="polite" aria-label="Featured stores" aria-hidden="true"></aside>
    </div>
  </header>

  <main class="container">
    <section class="hero" aria-labelledby="heroTitle">
      <div class="hero-content">
        <span class="hero-kicker">Amazon arbitrage platform</span>
        <h1 id="heroTitle">Unlock the best clearance deals to grow your listings</h1>
        <p>Centralise your product sourcing, plug in key suppliers and let our AI signals surface the most profitable discounts for Amazon.ca, Amazon.com and Europe.</p>
        <div class="hero-actions">
          <a class="btn btn-primary" href="#search">Explore inventories</a>
          <a class="btn btn-secondary" href="#amazon-sellers">See the benefits</a>
        </div>
        <ul class="hero-stats">
          <li class="hero-stat"><strong>+4 500</strong><span>Active deals</span></li>
          <li class="hero-stat"><strong>97 %</strong><span>Validated Amazon listings</span></li>
          <li class="hero-stat"><strong>12 h</strong><span>Hours saved each week</span></li>
        </ul>
      </div>
      <div class="hero-preview" aria-hidden="true">
        <article class="hero-preview-card">
          <header>
            <span>Snapshot</span>
            <div class="badge" style="margin:0">Canada feed</div>
          </header>
          <h2>Opportunities in focus</h2>
          <p>Track actionable price gaps between your favourite retailers and the Amazon Buy Box in real time.</p>
          <ul class="hero-preview-list">
            <li class="hero-preview-item"><span>1</span> Priority alerts when margin exceeds 28%.</li>
            <li class="hero-preview-item"><span>2</span> Consolidated stock statuses for Best Buy, Walmart and other partners.</li>
            <li class="hero-preview-item"><span>3</span> Instant export to your FBA and FBM templates.</li>
          </ul>
        </article>
      </div>
    </section>
    <section class="section value-section" id="investors">
      <div class="value-header">
        <h2>Signals that reassure investors</h2>
        <p class="muted">EconoDeal blends tangible usage indicators with an ambitious AI roadmap that proves its ability to create recurring value across markets.</p>
      </div>
      <div class="value-grid">
        <article class="value-card">
          <span class="value-icon" aria-hidden="true">üìä</span>
          <h3>Robust data-driven positioning</h3>
          <ul>
            <li><span class="value-metric">4,500+ active deals</span> consolidated in a single arbitrage-ready catalogue.</li>
            <li><span class="value-metric">97% of listings validated</span>, proving data quality and reliable Amazon exports.</li>
            <li><span class="value-metric">12 hours saved</span> per week on average by centralising sourcing workflows.</li>
          </ul>
        </article>
        <article class="value-card">
          <span class="value-icon" aria-hidden="true">üåê</span>
          <h3>Scalable technology</h3>
          <ul>
            <li><span class="value-metric">2.4M ASINs tracked</span> across Amazon.ca, Amazon.com and Amazon EU.</li>
            <li>Average detection of <span class="value-metric">18 seconds</span> between a new discount and its priority alert.</li>
            <li>AI insights recovering a <span class="value-metric">median +32% margin</span> on monitored scenarios.</li>
          </ul>
        </article>
        <article class="value-card">
          <span class="value-icon" aria-hidden="true">üó∫Ô∏è</span>
          <h3>Three-year growth vision</h3>
          <ul>
            <li>Sequenced expansion: Canada ‚Üí United States ‚Üí Europe with full localisation.</li>
            <li>Rollout of real-time alerts, predictive analytics and a multilingual AI recommendation engine.</li>
            <li>Progressive monetisation that adds Seller Central exports, AI scenarios and advanced market insights.</li>
          </ul>
        </article>
      </div>
    </section>
    <section class="section" id="search">
      <h2 style="margin:0 0 10px">Find clearance inventory for your Amazon listings</h2>
      <p class="muted">Files are loaded from <span class="kbd">data/&lt;store&gt;/&lt;city&gt;.json</span> to rapidly surface arbitrage opportunities.</p>

      <!-- ‚úÖ Les √©l√©ments requis existent et leurs IDs correspondent au script -->
      <div class="row" style="gap:12px;align-items:center;flex-wrap:wrap;margin-top:12px">
        <span class="muted" data-country-label>Covered country: Canada ¬∑ Currency: CAD</span>
      </div>

      <div class="filters" style="margin-top:12px">
        <div>
          <label for="searchInput">Quick search</label>
          <input id="searchInput" name="search" type="text" inputmode="search" placeholder="Ex. Nintendo Switch, Lego..." autocomplete="off" />
        </div>
        <div>
          <label for="storeSelect">Store</label>
          <select id="storeSelect">
            <option value="">(All)</option>
          </select>
        </div>
        <div>
          <label for="citySelect">City</label>
          <select id="citySelect">
            <option value="">(All)</option>
          </select>
        </div>
        <div>
          <label for="postalInput">Postal code</label>
          <input id="postalInput" name="postal" type="text" inputmode="text" placeholder="Ex. H2X 1Y4" autocomplete="postal-code" />
          <p id="postalHelper" class="field-helper">Enter the first three characters of the postal code to find branches within 50 km (e.g. H2X).</p>
        </div>
        <div>
          <label for="discountRange">Minimum discount: <span id="discountValue" class="kbd">0%</span></label>
          <input id="discountRange" type="range" min="0" max="90" step="5" value="0" />
        </div>
        <div style="align-self:end">
          <button id="btnClear">Reset filters</button>
        </div>
      </div>

      <div id="devError" class="dev-banner"></div>

      <div class="section">
        <div class="row" style="justify-content:space-between;align-items:center">
          <h3 style="margin:0">Results</h3>
          <div class="muted"><span id="resultCount">0</span> items</div>
        </div>
        <div id="cards" class="grid" style="margin-top:12px"></div>
      </div>
    </section>
    <section class="section value-section" id="client-value">
      <div class="value-header">
        <h2>Why paying clients stick with us</h2>
        <p class="muted">The platform reduces sourcing effort, aligns with Amazon resellers‚Äô critical needs and scales coherently as operations become more complex.</p>
      </div>
      <div class="value-grid">
        <article class="value-card">
          <span class="value-icon" aria-hidden="true">‚ö°</span>
          <h3>Immediate operational efficiency</h3>
          <ul>
            <li>Multi-criteria filters (store, city, postal code, discount threshold) to centralise product searches.</li>
            <li>Consolidated stock view and actionable price gaps without spreadsheets.</li>
            <li>Export-ready workflows for Seller Central in just a few clicks.</li>
          </ul>
        </article>
        <article class="value-card">
          <span class="value-icon" aria-hidden="true">üõí</span>
          <h3>Tailored to Amazon resellers</h3>
          <ul>
            <li>Guided FBA onboarding, streamlined fee calculation and FBM scenarios built in.</li>
            <li>Multi-supplier monitoring (Best Buy, Walmart, etc.) to secure the Buy Box.</li>
            <li>Private community, tactical workshops and dedicated assistance to stay ahead.</li>
          </ul>
        </article>
        <article class="value-card">
          <span class="value-icon" aria-hidden="true">üí°</span>
          <h3>Clear, gradual monetisation</h3>
          <ul>
            <li>Essential plan: fast access to top clearance deals and weekly alerts.</li>
            <li>Advanced plan: real-time alerts, Seller Central exports and team collaboration.</li>
            <li>Premium offer: AI analysis, trend forecasts and unlimited multichannel guidance.</li>
          </ul>
        </article>
      </div>
    </section>

    <section class="amazon-section" id="amazon-sellers">
      <div>
        <h2>An experience designed for Amazon resellers</h2>
        <p class="amazon-intro">Leverage a sourcing hub built for FBA and FBM operations: detect profitable clearance deals in seconds, protect your margins and structure sourcing routines for Amazon.ca and Amazon.com.</p>
      </div>
      <div class="seller-metrics">
        <div class="seller-metric">
          <strong>2,4&nbsp;M</strong>
          <span>ASINs tracked</span>
          <p>Dynamic mapping of Amazon.ca, Amazon.com and Amazon EU catalogues.</p>
        </div>
        <div class="seller-metric">
          <strong>18&nbsp;s</strong>
          <span>Average detection time</span>
          <p>Latency between importing a discount and alerting your team.</p>
        </div>
        <div class="seller-metric">
          <strong>+32&nbsp;%</strong>
          <span>Margin recovered</span>
          <p>Median gain observed among sellers using our AI scenarios.</p>
        </div>
      </div>
      <div class="seller-grid">
        <article class="seller-card">
          <div class="seller-icon" aria-hidden="true">üöÄ</div>
          <h3>Simplified FBA onboarding</h3>
          <p>Ready-to-use templates to calculate FBA fees, estimate rotation and sync your Amazon listings without complex spreadsheets.</p>
        </article>
        <article class="seller-card">
          <div class="seller-icon" aria-hidden="true">üì¶</div>
          <h3>Multi-supplier stock monitoring</h3>
          <p>Combine inventories from Best Buy, Walmart and other partners to spot exploitable price gaps before other Amazon sellers.</p>
        </article>
        <article class="seller-card">
          <div class="seller-icon" aria-hidden="true">ü§ù</div>
          <h3>Dedicated community</h3>
          <p>Access a private Amazon reseller lounge, share repricing strategies and benefit from community-validated product comparisons.</p>
        </article>
        <article class="seller-card">
          <div class="seller-icon" aria-hidden="true">üß≠</div>
          <h3>Operational coaching</h3>
          <ul class="seller-list">
            <li><span aria-hidden="true">‚úî</span>Alerts when the Buy Box drops below your target.</li>
            <li><span aria-hidden="true">‚úî</span>Seller Central-friendly exports and FBA analysis tools.</li>
            <li><span aria-hidden="true">‚úî</span>AI suggestions to repackage or arbitrage based on the season.</li>
          </ul>
        </article>
      </div>
    </section>

    <section class="section" id="pricing" style="padding-top:10px">
      <h2 style="margin:0 0 10px">Plans tailored to your needs</h2>
      <p class="muted" style="max-width:620px">Choose the option that best fits how you monitor discounts, feed your Amazon listings and protect your margins. Every plan includes a 7-day trial.</p>
      <div class="pricing-grid">
        <article class="pricing-card">
          <div class="pricing-tag">Essential</div>
          <h4>Core access</h4>
          <div class="pricing-price">9,99&nbsp;$</div>
          <ul class="pricing-features">
            <li>Access to popular Amazon-ready clearance deals</li>
            <li>3 email alerts per week</li>
            <li>30-day price history</li>
          </ul>
        </article>
        <article class="pricing-card pricing-highlight">
          <div class="pricing-tag">Most popular</div>
          <h4>Advanced plan</h4>
          <div class="pricing-price">19,99&nbsp;$</div>
          <ul class="pricing-features">
            <li>Unlimited access to the Amazon-optimised catalogue</li>
            <li>Real-time personalised alerts</li>
            <li>Seller Central exports and shared team lists</li>
          </ul>
        </article>
        <article class="pricing-card">
          <div class="pricing-tag">Premium</div>
          <h4>Full AI analysis</h4>
          <div class="pricing-price">29,99&nbsp;$</div>
          <ul class="pricing-features">
            <li>Unlimited multichannel alerts</li>
            <li>AI-assisted pricing analysis for Amazon</li>
            <li>Market trend forecasts and FBA simulation</li>
          </ul>
        </article>
      </div>
    </section>

    <section class="section" id="roadmap" style="padding-top:0">
      <h2 style="margin:0 0 10px">Our roadmap</h2>
      <p class="muted" style="max-width:640px">A three-year vision to propel EconoDeal internationally, progressively integrating artificial intelligence at the heart of our services.</p>
      <div class="roadmap">
        <div class="roadmap-grid">
          <article class="roadmap-card">
            <div class="roadmap-year"><strong>Year 1</strong> Canada</div>
            <ul>
              <li>Strengthen coverage of national retailers.</li>
              <li>Optimise real-time discount alerts.</li>
              <li>Launch bilingual regional dashboards.</li>
            </ul>
          </article>
          <article class="roadmap-card">
            <div class="roadmap-year"><strong>Year 2</strong> United States</div>
            <ul>
              <li>Expand the catalogue to major US banners.</li>
              <li>Deploy multi-state stock monitoring.</li>
              <li>Introduce predictive analysis of purchase trends.</li>
            </ul>
          </article>
          <article class="roadmap-card roadmap-ai">
            <div class="roadmap-year"><strong>Year 3</strong> Europe</div>
            <ul>
              <li>Localise the experience for key European markets.</li>
              <li>Activate a multilingual AI recommendation engine.</li>
              <li>Refine pricing strategies with continuous learning.</li>
            </ul>
          </article>
        </div>
      </div>
    </section>
  </main>

  <div class="container footer">
    <p style="margin:0 0 8px">EconoDeal is not responsible for the availability of displayed stock and does not store any personal information about visitors.</p>
    <div>¬© <span id="yearFooter"></span> EconoDeal ¬∑ All rights reserved</div>
  </div>

  <script>
  // === Safe initialisation ===
  document.addEventListener('DOMContentLoaded', async () => {
    const overlay = document.getElementById('registrationOverlay');
    const form = document.getElementById('registrationForm');
    const submitBtn = document.getElementById('registrationSubmit');
    const regulationCheckbox = document.getElementById('regulationCheckbox');
    const clientCountDisplays = Array.from(document.querySelectorAll('[data-client-count]'));
    const storeAdsContainer = document.getElementById('storeAds');
    function parseJson(value){
      if(!value) return null;
      try{
        return JSON.parse(value);
      }catch(err){
        console.warn('Unable to read existing data', err);
        return null;
      }
    }

    function safeGet(key){
      try{
        return localStorage.getItem(key);
      }catch(err){
        console.warn('Stockage local indisponible', err);
        return null;
      }
    }

    function safeSet(key, value){
      try{
        localStorage.setItem(key, value);
      }catch(err){
        console.warn('Unable to save data', err);
      }
    }

    function cleanText(value){
      return typeof value === 'string' ? value.trim() : '';
    }

    function getRegistrations(){
      const parsed = parseJson(safeGet('econodealRegistrations'));
      if(!Array.isArray(parsed)) return [];
      return parsed
        .filter(item => item && typeof item === 'object')
        .map(item => ({
          name: cleanText(item.name),
          email: cleanText(item.email).toLowerCase(),
          registeredAt: cleanText(item.registeredAt)
        }))
        .filter(item => item.email);
    }

    function saveRegistrations(items){
      safeSet('econodealRegistrations', JSON.stringify(items));
    }

    function upsertRegistration(entry){
      const collection = getRegistrations();
      const email = cleanText(entry.email).toLowerCase();
      if(!email) return;

      const normalized = {
        name: cleanText(entry.name),
        email,
        registeredAt: cleanText(entry.registeredAt)
      };

      const existingIndex = collection.findIndex(item => item.email === email);
      if(existingIndex >= 0){
        collection[existingIndex] = {
          ...collection[existingIndex],
          ...normalized
        };
      }else{
        collection.push(normalized);
      }

      saveRegistrations(collection);
    }

    function parseCount(value){
      const parsed = parseInt(value ?? '0', 10);
      return Number.isFinite(parsed) && parsed >= 0 ? parsed : 0;
    }

    function setClientCount(value){
      const normalized = Math.max(0, value);
      safeSet('econodealClientCount', String(normalized));
      return normalized;
    }

    function deriveClientCountFromRegistrations(){
      const registrations = getRegistrations();
      if(!registrations.length) return 0;
      const uniqueEmails = new Set();
      registrations.forEach(item => {
        if(item?.email) uniqueEmails.add(item.email);
      });
      return uniqueEmails.size;
    }

    function resolveClientCount(){
      const stored = parseCount(safeGet('econodealClientCount'));
      const derived = deriveClientCountFromRegistrations();
      const resolved = Math.max(stored, derived);
      if(resolved !== stored){
        setClientCount(resolved);
      }
      return resolved;
    }

    function updateClientCountDisplays(){
      const formatter = new Intl.NumberFormat('en-CA');
      const count = resolveClientCount();
      clientCountDisplays.forEach(el => {
        el.textContent = formatter.format(count);
      });
    }

    function hideOverlay(){
      if(!overlay) return;
      overlay.classList.add('hidden');
      overlay.setAttribute('aria-hidden', 'true');
      document.body.classList.remove('overlay-active');
    }

    function showOverlay(){
      if(!overlay) return;
      overlay.classList.remove('hidden');
      overlay.removeAttribute('aria-hidden');
      document.body.classList.add('overlay-active');
      updateClientCountDisplays();
    }

    resolveClientCount();
    updateClientCountDisplays();

    const alreadyRegistered = safeGet('econodealClientRegistered') === 'true';
    if(alreadyRegistered){
      hideOverlay();
    }else{
      showOverlay();
    }

    if(submitBtn && regulationCheckbox){
      submitBtn.disabled = !regulationCheckbox.checked;
      regulationCheckbox.addEventListener('change', () => {
        submitBtn.disabled = !regulationCheckbox.checked;
      });
    }

    if(form){
      form.addEventListener('submit', (event) => {
        event.preventDefault();
        if(!form.reportValidity()) return;

        const payload = {
          name: (form.fullName?.value ?? '').trim(),
          email: (form.email?.value ?? '').trim(),
          consent: true,
          registeredAt: new Date().toISOString()
        };

        safeSet('econodealUser', JSON.stringify(payload));
        upsertRegistration(payload);
        resolveClientCount();
        safeSet('econodealClientRegistered', 'true');
        updateClientCountDisplays();
        hideOverlay();
      });
    }

    window.addEventListener('storage', (event) => {
      if(!event) return;
      if(event.key === 'econodealRegistrations' || event.key === 'econodealClientCount'){
        updateClientCountDisplays();
      }
    });

    function baseBranches(){
      return [
        {label:'Montr√©al', slug:'montreal', city:'Montr√©al'},
        {label:'Laval', slug:'laval', city:'Laval'},
        {label:'Saint-J√©r√¥me', slug:'saint-jerome', city:'Saint-J√©r√¥me'},
        {label:'Blainville', slug:'blainville', city:'Blainville'}
      ];
    }
    function patrickMorinBranches(){
      return [
        {label:'Pr√©vost', slug:'prevost', city:'Pr√©vost'},
        {label:'Laval', slug:'laval', city:'Laval'}
      ];
    }

    function fullBestBuyBranches(){
      return [
        {label:'En ligne (Canada)', slug:'en-ligne', city:'En ligne', hasData:true},
        {label:'St. Jerome', slug:'st-jerome', city:'Saint-Jerome', address:'1040 Boul. du Grand-Heron, Saint-Jerome, QC', storeNumber:'658', hasData:true},
        {label:'Rosemere', slug:'rosemere-978', city:'Rosemere', address:'401 Boul. Labelle, Unit M-20, Rosemere, QC', storeNumber:'978', hasData:false},
        {label:'Mascouche', slug:'mascouche-663', city:'Mascouche', address:'113 Monte Masson, Bldg. C Unit 2, Mascouche, QC', storeNumber:'663', hasData:false},
        {label:'Best Buy Mobile Kiosk Laval', slug:'best-buy-mobile-kiosk-laval-543', city:'Laval', address:'3035 Boul. Le Carrefour, Unit ZD03, Laval, QC', storeNumber:'543', hasData:false},
        {label:'Laval', slug:'laval-968', city:'Laval', address:'1450 Boul. le Corbusier, Laval, QC', storeNumber:'968', hasData:false},
        {label:'Pointe Claire', slug:'pointe-claire-970', city:'Pointe-Claire', address:'6815 Autoroute Transcanadienne, Local #Y009, Pointe-Claire, QC', storeNumber:'970', hasData:false},
        {label:'Best Buy Mobile Kiosk Fairview Pointe-Claire', slug:'best-buy-mobile-kiosk-fairview-pointe-claire-541', city:'Pointe-Claire', address:'6815 Trans Canada Hwy, Unit Z040, Pointe-Claire, QC', storeNumber:'541', hasData:false},
        {label:'Marche Central', slug:'marche-central-962', city:'Montreal', address:'8871 Boul de L\'acadie, Montreal, QC', storeNumber:'962', hasData:false},
        {label:'Best Buy Mobile Galeries d\'Anjou', slug:'best-buy-mobile-galeries-d-anjou-243', city:'Anjou', address:'7999 Boul. Les Galeries d\'Anjou, Unit R006, Anjou, QC', storeNumber:'243', hasData:false},
        {label:'Anjou', slug:'anjou-84', city:'Anjou', address:'7400 Boul. des Roseraies, Anjou, QC', storeNumber:'84', hasData:false},
        {label:'Best Buy Express Kiosk Montreal-Pierre Elliott Trudeau International Airport', slug:'best-buy-express-kiosk-montreal-pierre-elliott-trudeau-international-airport-857', city:'Dorval', address:'975 Romeo-Vachon Blvd N, Dorval, QC', storeNumber:'857', hasData:false},
        {label:'Best Buy Express Kiosk Montreal-Pierre Elliott Trudeau International Airport', slug:'best-buy-express-kiosk-montreal-pierre-elliott-trudeau-international-airport-855', city:'Dorval', address:'975 Romeo-Vachon Blvd N, Dorval, QC', storeNumber:'855', hasData:false},
        {label:'Best Buy Express Kiosk Montreal-Pierre Elliott Trudeau International Airport', slug:'best-buy-express-kiosk-montreal-pierre-elliott-trudeau-international-airport-856', city:'Dorval', address:'975 Romeo-Vachon Blvd N, Dorval, QC', storeNumber:'856', hasData:false},
        {label:'Best Buy Mobile Place Versailles', slug:'best-buy-mobile-place-versailles-251', city:'Montreal', address:'7275 Rue Sherbrooke E, Unit 121, Montreal, QC', storeNumber:'251', hasData:false},
        {label:'Vaudreuil', slug:'vaudreuil-674', city:'Vaudreuil-Dorion', address:'3090 Boul. de la Gare, Vaudreuil-Dorion, QC', storeNumber:'674', hasData:false},
        {label:'Centreville', slug:'centreville-651', city:'Montreal', address:'470 Rue Ste. Catherine O, Montreal, QC', storeNumber:'651', hasData:false},
        {label:'Best Buy Mobile Montreal Eaton Centre', slug:'best-buy-mobile-montreal-eaton-centre-252', city:'Montreal', address:'705 Rue Sainte-Catharine O, Unit 2114A, Montreal, QC', storeNumber:'252', hasData:false},
        {label:'LaSalle', slug:'lasalle-967', city:'LaSalle', address:'7077 Boul. Newman, LaSalle, QC', storeNumber:'967', hasData:false},
        {label:'Taschereau', slug:'taschereau-82', city:'Greenfield Park', address:'1800 Rue Auguste, Greenfield Park, QC', storeNumber:'82', hasData:false},
        {label:'Brossard', slug:'brossard-969', city:'Brossard', address:'8480 Boul. Leduc, Unit 100, Brossard, QC', storeNumber:'969', hasData:false},
        {label:'St. Bruno', slug:'st-bruno-971', city:'Saint-Bruno', address:'1235 Boul. des Promenades, Saint-Bruno, QC', storeNumber:'971', hasData:false},
        {label:'Saint Jean', slug:'saint-jean-681', city:'Saint-Jean-sur-Richelieu', address:'600 Rue Pierre-Caisse, Unit 4000, Saint-Jean-sur-Richelieu, QC', storeNumber:'681', hasData:false},
        {label:'Cornwall', slug:'cornwall-637', city:'Cornwall', address:'501 Tollgate Rd. W, Unit 6, Cornwall, ON', storeNumber:'637', hasData:false},
        {label:'Granby', slug:'granby-673', city:'Granby', address:'90 Rue Simonds N, Granby, QC', storeNumber:'673', hasData:false},
        {label:'Drummondville', slug:'drummondville-680', city:'Drummondville', address:'850 Rue Hains, Drummondville, QC', storeNumber:'680', hasData:false},
        {label:'Orleans', slug:'orleans-627', city:'Orleans', address:'2020 Mer Bleue Rd., Unit C2, Orleans, ON', storeNumber:'627', hasData:false},
        {label:'Best Buy Mobile Place d\'Orleans', slug:'best-buy-mobile-place-d-orleans-224', city:'Ottawa', address:'110 Place d\' Orleans Dr., Unit 0200, Ottawa, ON', storeNumber:'224', hasData:false},
        {label:'Trois-Rivieres', slug:'trois-rivieres-668', city:'Trois-Rivieres', address:'4520 Boul. des Recollets, Unit 900A, Trois-Rivieres, QC', storeNumber:'668', hasData:false},
        {label:'Ottawa East', slug:'ottawa-east-940', city:'Ottawa', address:'380 Coventry Rd., Ottawa, ON', storeNumber:'940', hasData:false},
        {label:'Gatineau', slug:'gatineau-972', city:'Gatineau', address:'920 Maloney Blvd. W, Gatineau, QC', storeNumber:'972', hasData:false},
        {label:'Best Buy Express Kiosk Ottawa International Airport', slug:'best-buy-express-kiosk-ottawa-international-airport-858', city:'Ottawa', address:'1000 Airport Parkway Private, Ottawa, ON', storeNumber:'858', hasData:false},
        {label:'Best Buy Express Kiosk Ottawa International Airport', slug:'best-buy-express-kiosk-ottawa-international-airport-859', city:'Ottawa', address:'1000 Airport Parkway Private, Ottawa, ON', storeNumber:'859', hasData:false},
        {label:'Ottawa West', slug:'ottawa-west-928', city:'Nepean', address:'1701 Merivale Rd., Nepean, ON', storeNumber:'928', hasData:false},
        {label:'Barrhaven', slug:'barrhaven-639', city:'Nepean', address:'3777 Strandherd Dr., Nepean, ON', storeNumber:'639', hasData:false},
        {label:'Kanata', slug:'kanata-975', city:'Kanata', address:'745 Kanata Ave., Kanata, ON', storeNumber:'975', hasData:false},
        {label:'Sherbrooke', slug:'sherbrooke-659', city:'Sherbrooke', address:'3450 Boul. de Portland, Sherbrooke, QC', storeNumber:'659', hasData:false},
        {label:'Place Laurier', slug:'place-laurier-906', city:'Quebec', address:'2700 Boul. Laurier, Unit 2290, Quebec, QC', storeNumber:'906', hasData:false},
        {label:'La Capitale', slug:'la-capitale-907', city:'Quebec', address:'5401 Boul. des Galeries, Quebec, QC', storeNumber:'907', hasData:false},
        {label:'Best Buy Mobile Cataraqui Town Centre', slug:'best-buy-mobile-cataraqui-town-centre-236', city:'Kingston', address:'945 Gardiners Rd., Unit L30A, Kingston, ON', storeNumber:'236', hasData:false},
        {label:'Kingston', slug:'kingston-964', city:'Kingston', address:'A009-770 Gardiners Rd., Kingston, ON', storeNumber:'964', hasData:false},
        {label:'Best Buy Mobile Quinte', slug:'best-buy-mobile-quinte-210', city:'Belleville', address:'390 North Front St., Unit P6, Belleville, ON', storeNumber:'210', hasData:false},
        {label:'Belleville', slug:'belleville-989', city:'Belleville', address:'202 Bell Blvd., Belleville, ON', storeNumber:'989', hasData:false},
        {label:'Chicoutimi', slug:'chicoutimi-653', city:'Chicoutimi', address:'1401 Boul. Talbot, Chicoutimi, QC', storeNumber:'653', hasData:false},
        {label:'Best Buy Mobile Lansdowne Place', slug:'best-buy-mobile-lansdowne-place-218', city:'Peterborough', address:'645 Lansdowne St. W, Unit 136B, Peterborough, ON', storeNumber:'218', hasData:false},
        {label:'Peterborough', slug:'peterborough-621', city:'Peterborough', address:'1101 Lansdowne St. W, Peterborough, ON', storeNumber:'621', hasData:false},
        {label:'North Bay', slug:'north-bay-632', city:'North Bay', address:'1500 Fisher St., North Bay, ON', storeNumber:'632', hasData:false},
        {label:'Oshawa', slug:'oshawa-613', city:'Oshawa', address:'1421 Harmony Rd. N, Oshawa, ON', storeNumber:'613', hasData:false},
        {label:'Whitby', slug:'whitby-959', city:'Whitby', address:'1751 Victoria St. E, Whitby, ON', storeNumber:'959', hasData:false},
        {label:'Orillia', slug:'orillia-626', city:'Orillia', address:'3200 Monarch Dr., Unit 1, Orillia, ON', storeNumber:'626', hasData:false},
        {label:'Ajax', slug:'ajax-925', city:'Ajax', address:'20 Kingston Rd. W, Ajax, ON', storeNumber:'925', hasData:false},
        {label:'Best Buy Mobile Pickering', slug:'best-buy-mobile-pickering-223', city:'Pickering', address:'1355 Kingston Rd., Unit 78, Pickering, ON', storeNumber:'223', hasData:false},
        {label:'Markham', slug:'markham-937', city:'Markham', address:'5000 Hwy 7 E, Unit 2070L, Markham, ON', storeNumber:'937', hasData:false},
        {label:'Aurora', slug:'aurora-985', city:'Aurora', address:'52 First Commerce Dr., Unit 2, Aurora, ON', storeNumber:'985', hasData:false},
        {label:'Scarborough', slug:'scarborough-943', city:'Scarborough', address:'480 Progress Ave., Scarborough, ON', storeNumber:'943', hasData:false},
        {label:'Newmarket', slug:'newmarket-949', city:'East Gwillimbury', address:'175 Green Lane E, East Gwillimbury, ON', storeNumber:'949', hasData:false},
        {label:'Best Buy Mobile Georgian Mall', slug:'best-buy-mobile-georgian-mall-225', city:'Barrie', address:'509 Bayfield St., Unit B005, Barrie, ON', storeNumber:'225', hasData:false},
        {label:'Barrie', slug:'barrie-953', city:'Barrie', address:'80 Concert Way, Unit 2, Barrie, ON', storeNumber:'953', hasData:false},
        {label:'Warden', slug:'warden-965', city:'Scarborough', address:'50 Ashtonbee Rd., Unit 2, Scarborough, ON', storeNumber:'965', hasData:false},
        {label:'Richmond Hill', slug:'richmond-hill-956', city:'Richmond Hill', address:'225 High Tech Rd., Unit 3, Richmond Hill, ON', storeNumber:'956', hasData:false},
        {label:'Best Buy Mobile Centrepoint Mall', slug:'best-buy-mobile-centrepoint-mall-237', city:'North York', address:'6464 Yonge St., Unit 106, North York, ON', storeNumber:'237', hasData:false},
        {label:'Leaside', slug:'leaside-931', city:'East York', address:'147 Laird Dr., East York, ON', storeNumber:'931', hasData:false},
        {label:'Yonge & Eglinton', slug:'yonge-eglinton-62', city:'Toronto', address:'2400 Yonge St., Toronto, ON', storeNumber:'62', hasData:false},
        {label:'Bay & Dundas', slug:'bay-dundas-977', city:'Toronto', address:'65 Dundas St. W, Toronto, ON', storeNumber:'977', hasData:false},
        {label:'Downsview', slug:'downsview-927', city:'North York', address:'695 Wilson Ave., North York, ON', storeNumber:'927', hasData:false},
        {label:'Best Buy Mobile Vaughan Mills', slug:'best-buy-mobile-vaughan-mills-200', city:'Vaughan', address:'1 Bass Pro Mills Dr., Unit 327, Vaughan, ON', storeNumber:'200', hasData:false},
        {label:'Best Buy Mobile Dufferin Mall', slug:'best-buy-mobile-dufferin-mall-203', city:'Toronto', address:'900 Dufferin St., Unit 0455, Toronto, ON', storeNumber:'203', hasData:false},
        {label:'Woodbridge', slug:'woodbridge-932', city:'Woodbridge', address:'7850 Weston Rd. , Bldg. E Unit 1, Woodbridge, ON', storeNumber:'932', hasData:false},
        {label:'Keele & St. Clair', slug:'keele-st-clair-617', city:'Toronto', address:'10 Old Stock Yards Rd., Toronto, ON', storeNumber:'617', hasData:false},
        {label:'Weston & HWY 401', slug:'weston-hwy-401-57', city:'North York', address:'2625A Weston Rd., North York, ON', storeNumber:'57', hasData:false},
        {label:'Sherway', slug:'sherway-938', city:'Etobicoke', address:'167 North Queen St., Etobicoke, ON', storeNumber:'938', hasData:false},
        {label:'Best Buy Express Kiosk Niagara Falls', slug:'best-buy-express-kiosk-niagara-falls-823', city:'Niagara Falls', address:'6455 Fallsview Blvd., Niagara Falls, ON', storeNumber:'823', hasData:false},
        {label:'Distribution Centre East', slug:'distribution-centre-east-795', city:'Brampton', address:'9250 Airport Road, Brampton, ON', storeNumber:'795', hasData:false},
        {label:'Appliance Clearance Centre Brampton', slug:'appliance-clearance-centre-brampton-916', city:'Brampton', address:'9200 Airport Rd, Brampton, ON', storeNumber:'916', hasData:false},
        {label:'Brampton Distribution Centre', slug:'brampton-distribution-centre-544', city:'Brampton', address:'9250 Airport Road, Brampton, ON', storeNumber:'544', hasData:false},
        {label:'Brampton Warehouse Pick-up', slug:'brampton-warehouse-pick-up-910', city:'Brampton', address:'Door # 22 - 9200 Airport Rd, Brampton, ON', storeNumber:'910', hasData:false},
        {label:'Brampton', slug:'brampton-954', city:'Brampton', address:'25 Peel Centre Dr., Unit 451, Brampton, ON', storeNumber:'954', hasData:false},
        {label:'Best Buy Mobile Bramalea City Centre', slug:'best-buy-mobile-bramalea-city-centre-207', city:'Brampton', address:'25 Peel Centre Dr., Unit 506, Brampton, ON', storeNumber:'207', hasData:false},
        {label:'Best Buy Mobile Square One', slug:'best-buy-mobile-square-one-202', city:'Mississauga', address:'100 City Centre Dr., Unit 1-839, Mississauga, ON', storeNumber:'202', hasData:false},
        {label:'Best Buy Mobile Pen Centre', slug:'best-buy-mobile-pen-centre-208', city:'St. Catharines', address:'221 Glendale Ave., Unit 146, St. Catharines, ON', storeNumber:'208', hasData:false},
        {label:'St Catharines', slug:'st-catharines-950', city:'St Catharines', address:'420 Vansickle Rd. Unit L1, St Catharines, ON', storeNumber:'950', hasData:false},
        {label:'Heartland', slug:'heartland-926', city:'Mississauga', address:'6075 Mavis Rd., Unit 1, Mississauga, ON', storeNumber:'926', hasData:false},
        {label:'Best Buy Mobile Woodbine Centre', slug:'best-buy-mobile-woodbine-centre-233', city:'Etobicoke', address:'500 Rexdale Blvd., Unit F006, Etobicoke, ON', storeNumber:'233', hasData:false},
        {label:'Oakville', slug:'oakville-930', city:'Oakville', address:'2500 Winston Park Dr., Unit A, Oakville, ON', storeNumber:'930', hasData:false},
        {label:'Winston Churchill', slug:'winston-churchill-622', city:'Mississauga', address:'2975 Argentia Rd., Mississauga, ON', storeNumber:'622', hasData:false},
        {label:'Best Buy Mobile Oakville Place', slug:'best-buy-mobile-oakville-place-245', city:'Oakville', address:'240 Leighland Ave., Unit 210A, Oakville, ON', storeNumber:'245', hasData:false},
        {label:'Orangeville', slug:'orangeville-615', city:'Orangeville', address:'95 First St., Orangeville, ON', storeNumber:'615', hasData:false},
        {label:'Milton', slug:'milton-990', city:'Milton', address:'1195 Maple Ave., Milton, ON', storeNumber:'990', hasData:false},
        {label:'Best Buy Mobile Burlington Mall', slug:'best-buy-mobile-burlington-mall-206', city:'Burlington', address:'777 Guelph Line, Unit H7A, Burlington, ON', storeNumber:'206', hasData:false},
        {label:'Burlington', slug:'burlington-942', city:'Burlington', address:'1200 Brant St., Unit 1, Burlington, ON', storeNumber:'942', hasData:false},
        {label:'Sudbury', slug:'sudbury-901', city:'Sudbury', address:'1099 Marcus Dr., Sudbury, ON', storeNumber:'901', hasData:false},
        {label:'Hamilton', slug:'hamilton-984', city:'Stoney Creek', address:'1779 Stone Church Rd. E, Stoney Creek, ON', storeNumber:'984', hasData:false},
        {label:'Best Buy Mobile Lime Ridge', slug:'best-buy-mobile-lime-ridge-213', city:'Hamilton', address:'999 Upper Wentworth St., Unit 0450, Hamilton, ON', storeNumber:'213', hasData:false},
        {label:'Ancaster', slug:'ancaster-982', city:'Ancaster', address:'14 Martindale Cres., Unit 1, Ancaster, ON', storeNumber:'982', hasData:false},
        {label:'Guelph', slug:'guelph-631', city:'Guelph', address:'151 Stone Rd. West, Guelph, ON', storeNumber:'631', hasData:false},
        {label:'Cambridge', slug:'cambridge-995', city:'Cambridge', address:'28 Pinebush Rd., Cambridge, ON', storeNumber:'995', hasData:false},
        {label:'Best Buy Mobile Cambridge Centre', slug:'best-buy-mobile-cambridge-centre-247', city:'Cambridge', address:'355 Hespeler Rd., Unit 301, Cambridge, ON', storeNumber:'247', hasData:false},
        {label:'Fredericton', slug:'fredericton-669', city:'Fredericton', address:'1220 Prospect St., Fredericton, NB', storeNumber:'669', hasData:false},
        {label:'Best Buy Mobile Fairview Park', slug:'best-buy-mobile-fairview-park-235', city:'Kitchener', address:'2960 Kingsway Dr., Unit G005A, Kitchener, ON', storeNumber:'235', hasData:false},
        {label:'Kitchener', slug:'kitchener-935', city:'Kitchener', address:'215 Fairway Rd. S, Kitchener, ON', storeNumber:'935', hasData:false},
        {label:'Brantford', slug:'brantford-620', city:'Brantford', address:'61 Lynden Rd., Unit A, Brantford, ON', storeNumber:'620', hasData:false},
        {label:'Best Buy Mobile Conestoga', slug:'best-buy-mobile-conestoga-219', city:'Waterloo', address:'550 King St. N, Unit H16, Waterloo, ON', storeNumber:'219', hasData:false},
        {label:'Waterloo', slug:'waterloo-608', city:'Waterloo', address:'580 King St. N, Bldg. B, Waterloo, ON', storeNumber:'608', hasData:false},
        {label:'Saint John', slug:'saint-john-661', city:'Saint John', address:'80 Consumers Dr., Saint John, NB', storeNumber:'661', hasData:false},
        {label:'Timmins', slug:'timmins-634', city:'Timmins', address:'1390 Riverside Dr., Timmins, ON', storeNumber:'634', hasData:false},
        {label:'Best Buy Mobile Masonville Place', slug:'best-buy-mobile-masonville-place-246', city:'London', address:'1680 Richmond St. N, Unit L027A, London, ON', storeNumber:'246', hasData:false},
        {label:'North London', slug:'north-london-980', city:'London', address:'1735 Richmond St., Unit 1, London, ON', storeNumber:'980', hasData:false},
        {label:'London (South)', slug:'london-south-936', city:'London', address:'1080 Wellington Rd., London, ON', storeNumber:'936', hasData:false},
        {label:'Moncton', slug:'moncton-81', city:'Moncton', address:'50 Plaza Blvd., Moncton, NB', storeNumber:'81', hasData:false},
        {label:'Sarnia', slug:'sarnia-610', city:'Sarnia', address:'1380 Exmouth St., Sarnia, ON', storeNumber:'610', hasData:false},
        {label:'Chatham', slug:'chatham-624', city:'Chatham', address:'802 St. Claire St., Chatham, ON', storeNumber:'624', hasData:false},
        {label:'Sault Ste. Marie', slug:'sault-ste-marie-625', city:'Sault Ste. Marie', address:'548 Great Northern Rd., Sault Ste. Marie, ON', storeNumber:'625', hasData:false},
        {label:'Windsor', slug:'windsor-944', city:'Windsor', address:'4379 Walker Rd., Windsor, ON', storeNumber:'944', hasData:false},
        {label:'Best Buy Mobile Devonshire', slug:'best-buy-mobile-devonshire-211', city:'Windsor', address:'3100 Howard Ave., Unit SS7, Windsor, ON', storeNumber:'211', hasData:false},
        {label:'Halifax', slug:'halifax-912', city:'Halifax', address:'11 Washmill Lake Dr., Halifax, NS', storeNumber:'912', hasData:false},
        {label:'Best Buy Express Kiosk Dalhousie University Bookstore', slug:'best-buy-express-kiosk-dalhousie-university-bookstore-820', city:'Halifax', address:'6136 University Ave, Halifax, NS', storeNumber:'820', hasData:false},
        {label:'Best Buy Express Kiosk Halifax Stanfield International Airport', slug:'best-buy-express-kiosk-halifax-stanfield-international-airport-833', city:'Enfield', address:'1 Bell Blvd., Enfield, NS', storeNumber:'833', hasData:false},
        {label:'Dartmouth', slug:'dartmouth-979', city:'Dartmouth', address:'119 Gale Terrace, Bldg. 1K-4, Dartmouth, NS', storeNumber:'979', hasData:false},
        {label:'Charlottetown', slug:'charlottetown-660', city:'Charlottetown', address:'191 Buchanan Dr., Charlottetown, PE', storeNumber:'660', hasData:false},
        {label:'Best Buy Mobile Mayflower Mall', slug:'best-buy-mobile-mayflower-mall-238', city:'Sydney', address:'800 Grand Lake Rd., Unit E63, Sydney, NS', storeNumber:'238', hasData:false},
        {label:'Sydney', slug:'sydney-672', city:'Sydney', address:'800 Grand Lake Rd., Unit E60, Sydney, NS', storeNumber:'672', hasData:false},
        {label:'Thunder Bay', slug:'thunder-bay-79', city:'Thunder Bay', address:'767 Memorial Ave., Unit 1, Thunder Bay, ON', storeNumber:'79', hasData:false},
        {label:'St. Johns', slug:'st-johns-909', city:'St. Johns', address:'3 Stavanger Dr., St. Johns, NL', storeNumber:'909', hasData:false},
        {label:'Regent', slug:'regent-948', city:'Winnipeg', address:'1580 Regent Ave. W, Unit 10, Winnipeg, MB', storeNumber:'948', hasData:false},
        {label:'Pembina', slug:'pembina-32', city:'Winnipeg', address:'1910 Pembina Hwy., Unit 6, Winnipeg, MB', storeNumber:'32', hasData:false},
        {label:'St James', slug:'st-james-946', city:'Winnipeg', address:'810 St. James St., Unit A, Winnipeg, MB', storeNumber:'946', hasData:false},
        {label:'Best Buy Express Kiosk Winnipeg James Armstrong Richardson International Airport', slug:'best-buy-express-kiosk-winnipeg-james-armstrong-richardson-international-airport-824', city:'Winnipeg', address:'9070 Wellington Ave., Winnipeg, MB', storeNumber:'824', hasData:false},
        {label:'Brandon', slug:'brandon-744', city:'Brandon', address:'901A 18th St. N, Brandon, MB', storeNumber:'744', hasData:false},
        {label:'Regina', slug:'regina-955', city:'Regina', address:'2125 Prince of Wales Dr., Regina, SK', storeNumber:'955', hasData:false},
        {label:'Best Buy Express Kiosk Regina International Airport', slug:'best-buy-express-kiosk-regina-international-airport-861', city:'Regina', address:'5201 Regina Av., Regina, SK', storeNumber:'861', hasData:false},
        {label:'Prince Albert', slug:'prince-albert-742', city:'Prince Albert', address:'800 15th St. E, Unit 300, Prince Albert, SK', storeNumber:'742', hasData:false},
        {label:'Saskatoon', slug:'saskatoon-974', city:'Saskatoon', address:'3310 8th St. E, Unit 20A, Saskatoon, SK', storeNumber:'974', hasData:false},
        {label:'Preston Crossing', slug:'preston-crossing-39', city:'Saskatoon', address:'1723 Preston Ave. N, Unit 221, Saskatoon, SK', storeNumber:'39', hasData:false},
        {label:'Best Buy Express Kiosk Saskatoon International Airport', slug:'best-buy-express-kiosk-saskatoon-international-airport-822', city:'Saskatoon', address:'2625 Airport Fr., Saskatoon, SK', storeNumber:'822', hasData:false},
        {label:'Best Buy Express Kiosk Pharmasave Swift Current', slug:'best-buy-express-kiosk-pharmasave-swift-current-816', city:'Swift Current', address:'390 Central Ave. N, Swift Current, SK', storeNumber:'816', hasData:false},
        {label:'Lloydminster', slug:'lloydminster-749', city:'Lloydminster', address:'7501 44th St., Unit 101, Lloydminster, AB', storeNumber:'749', hasData:false},
        {label:'Medicine Hat', slug:'medicine-hat-23', city:'Medicine Hat', address:'3292 Dunmore Rd. SE, Unit 600, Medicine Hat, AB', storeNumber:'23', hasData:false},
        {label:'Best Buy Express Kiosk Fort McMurray Airport', slug:'best-buy-express-kiosk-fort-mcmurray-airport-864', city:'Fort McMurray', address:'100 Snowbird Way, Unit 300, Fort McMurray, AB', storeNumber:'864', hasData:false},
        {label:'Lethbridge', slug:'lethbridge-904', city:'Lethbridge', address:'3734 Mayor Magrath Dr. S, Unit 1C, Lethbridge, AB', storeNumber:'904', hasData:false},
        {label:'SE Edmonton', slug:'se-edmonton-988', city:'Edmonton', address:'2040 38 Ave. NW, Edmonton, AB', storeNumber:'988', hasData:false},
        {label:'NE Edmonton', slug:'ne-edmonton-34', city:'Edmonton', address:'4250 137 Ave., Edmonton, AB', storeNumber:'34', hasData:false},
        {label:'Best Buy Mobile Londonderry', slug:'best-buy-mobile-londonderry-214', city:'Edmonton', address:'149 - 1 Londonderry Mall NW, Edmonton, AB', storeNumber:'214', hasData:false},
        {label:'Best Buy Mobile Kiosk West Ed Mall', slug:'best-buy-mobile-kiosk-west-ed-mall-545', city:'Edmonton', address:'2172 - 8882 170 Street NW, Edmonton, AB', storeNumber:'545', hasData:false},
        {label:'Edmonton South', slug:'edmonton-south-934', city:'Edmonton', address:'9931 19 Ave. NW, Edmonton, AB', storeNumber:'934', hasData:false},
        {label:'Downtown Edmonton', slug:'downtown-edmonton-33', city:'Edmonton', address:'10304 109th St. NW, Edmonton, AB', storeNumber:'33', hasData:false},
        {label:'Edmonton North', slug:'edmonton-north-951', city:'Edmonton', address:'13924 137 Ave. NW, Edmonton, AB', storeNumber:'951', hasData:false},
        {label:'Best Buy Express Kiosk Edmonton International Airport', slug:'best-buy-express-kiosk-edmonton-international-airport-863', city:'Edmonton', address:'1000 Airport Rd., Edmonton, AB', storeNumber:'863', hasData:false},
        {label:'Best Buy Mobile West Ed Mall', slug:'best-buy-mobile-west-ed-mall-249', city:'Edmonton', address:'1340 - 8882 170 Street NW, Edmonton, AB', storeNumber:'249', hasData:false},
        {label:'Edmonton West', slug:'edmonton-west-933', city:'Edmonton', address:'17539 Stony Plain Rd. NW, Edmonton, AB', storeNumber:'933', hasData:false},
        {label:'Best Buy Mobile Parkland Mall', slug:'best-buy-mobile-parkland-mall-230', city:'Red Deer', address:'4747 67th St., Unit 221, Red Deer, AB', storeNumber:'230', hasData:false},
        {label:'Red Deer', slug:'red-deer-960', city:'Red Deer', address:'5001 19th St., Unit 800, Red Deer, AB', storeNumber:'960', hasData:false},
        {label:'Best Buy Mobile Marlborough', slug:'best-buy-mobile-marlborough-209', city:'Calgary', address:'3800 Memorial Drive NE, Unit 1237, Calgary, AB', storeNumber:'209', hasData:false},
        {label:'Best Buy Mobile Sunridge Mall', slug:'best-buy-mobile-sunridge-mall-205', city:'Calgary', address:'2525 36th St. NE, Unit 120, Calgary, AB', storeNumber:'205', hasData:false},
        {label:'Sunridge', slug:'sunridge-945', city:'Calgary', address:'3319-26th Avenue NE, Calgary, AB', storeNumber:'945', hasData:false},
        {label:'Best Buy Express Kiosk Calgary International Airport', slug:'best-buy-express-kiosk-calgary-international-airport-862', city:'Calgary', address:'2000 Airport Rd. NE, Calgary, AB', storeNumber:'862', hasData:false},
        {label:'Deerfoot Meadows', slug:'deerfoot-meadows-947', city:'Calgary', address:'8180 11th St. SE,Unit 300, Calgary, AB', storeNumber:'947', hasData:false},
        {label:'Best Buy Mobile Southcentre Mall', slug:'best-buy-mobile-southcentre-mall-231', city:'Calgary', address:'100 Anderson Rd. SE, Unit 346, Calgary, AB', storeNumber:'231', hasData:false},
        {label:'Best Buy Mobile Chinook Centre', slug:'best-buy-mobile-chinook-centre-204', city:'Calgary', address:'6455 Macleod Trail SW, Unit 0155, Calgary, AB', storeNumber:'204', hasData:false},
        {label:'Shawnessy', slug:'shawnessy-741', city:'Calgary', address:'350R Shawville Blvd. SE, Unit 110, Calgary, AB', storeNumber:'741', hasData:false},
        {label:'Calgary 17th Avenue', slug:'calgary-17th-avenue-998', city:'Calgary', address:'901 17th Ave. SW, Calgary, AB', storeNumber:'998', hasData:false},
        {label:'Northland', slug:'northland-976', city:'Calgary', address:'5111 Northland Dr. NW, Unit 350, Calgary, AB', storeNumber:'976', hasData:false},
        {label:'Beacon Hill', slug:'beacon-hill-746', city:'Calgary', address:'11810 Sarcee Trail NW, Calgary, AB', storeNumber:'746', hasData:false},
        {label:'Best Buy Mobile Kiosk Market Mall', slug:'best-buy-mobile-kiosk-market-mall-542', city:'Calgary', address:'3625 Shaganappi Trail NW, Unit Z029, Calgary, AB', storeNumber:'542', hasData:false},
        {label:'Westhills Calgary', slug:'westhills-calgary-902', city:'Calgary', address:'350 Stewart Green SW, Calgary, AB', storeNumber:'902', hasData:false},
        {label:'Grande Prairie', slug:'grande-prairie-986', city:'Grande Prairie', address:'9817 116th St., Grande Prairie, AB', storeNumber:'986', hasData:false},
        {label:'Vernon', slug:'vernon-704', city:'Vernon', address:'5600 24th St., Vernon, BC', storeNumber:'704', hasData:false},
        {label:'Best Buy Mobile Village Green Mall', slug:'best-buy-mobile-village-green-mall-232', city:'Vernon', address:'4900 27th St., Unit 205, Vernon, BC', storeNumber:'232', hasData:false},
        {label:'Best Buy Express Kiosk Kelowna International Airport', slug:'best-buy-express-kiosk-kelowna-international-airport-832', city:'Kelowna', address:'5533 Airport Way, Unit 1, Kelowna, BC', storeNumber:'832', hasData:false},
        {label:'Kelowna', slug:'kelowna-914', city:'Kelowna', address:'2271 Harvey Ave., Unit 1403, Kelowna, BC', storeNumber:'914', hasData:false},
        {label:'Kamloops', slug:'kamloops-14', city:'Kamloops', address:'1320 West Trans Canada Hwy., Unit Y700, Kamloops, BC', storeNumber:'14', hasData:false},
        {label:'Best Buy Mobile Aberdeen', slug:'best-buy-mobile-aberdeen-215', city:'Kamloops', address:'1320 Trans Canada Hwy. W, Unit 261A, Kamloops, BC', storeNumber:'215', hasData:false},
        {label:'Prince George', slug:'prince-george-700', city:'Prince George', address:'3900 Walls Ave., Unit 201, Prince George, BC', storeNumber:'700', hasData:false},
        {label:'Chilliwack', slug:'chilliwack-703', city:'Chilliwack', address:'45805 Luckakuck Way, Unit 109, Chilliwack, BC', storeNumber:'703', hasData:false},
        {label:'Abbotsford', slug:'abbotsford-992', city:'Abbotsford', address:'32900 South Fraser Way, Unit 4, Abbotsford, BC', storeNumber:'992', hasData:false},
        {label:'Distribution Centre West', slug:'distribution-centre-west-796', city:'Langley', address:'19890 92A Ave, Langley, BC', storeNumber:'796', hasData:false},
        {label:'Appliance Clearance Centre Langley', slug:'appliance-clearance-centre-langley-915', city:'Langley', address:'Door # 19 - 19890 92A Ave, Langley, BC', storeNumber:'915', hasData:false},
        {label:'Langley', slug:'langley-929', city:'Langley', address:'20202 66th Ave., Unit F3, Langley, BC', storeNumber:'929', hasData:false},
        {label:'Coquitlam', slug:'coquitlam-958', city:'Coquitlam', address:'2929 Barnet Hwy., Unit 2140, Coquitlam, BC', storeNumber:'958', hasData:false},
        {label:'South Surrey', slug:'south-surrey-701', city:'Surrey', address:'2267 160th St., Surrey, BC', storeNumber:'701', hasData:false},
        {label:'Best Buy Mobile Central City', slug:'best-buy-mobile-central-city-226', city:'Surrey', address:'13450 102nd Ave., Unit 142, Surrey, BC', storeNumber:'226', hasData:false},
        {label:'Surrey', slug:'surrey-961', city:'Surrey', address:'10153 King George Boulevard, Unit 3200, Surrey, BC', storeNumber:'961', hasData:false},
        {label:'Scott Road', slug:'scott-road-600', city:'Surrey', address:'12048 80th Ave., Surrey, BC', storeNumber:'600', hasData:false},
        {label:'Station Square', slug:'station-square-973', city:'Burnaby', address:'6200 McKay Ave., Unit 200, Burnaby, BC', storeNumber:'973', hasData:false},
        {label:'Best Buy Mobile Pacific Centre', slug:'best-buy-mobile-pacific-centre-242', city:'Vancouver', address:'PO Box 10306 701 West Georgia St., Unit D038C, Vancouver, BC', storeNumber:'242', hasData:false},
        {label:'Robson & Granville', slug:'robson-granville-705', city:'Vancouver', address:'798 Granville St. , Suite 200, Vancouver, BC', storeNumber:'705', hasData:false},
        {label:'Cambie', slug:'cambie-952', city:'Vancouver', address:'2220 Cambie St., Vancouver, BC', storeNumber:'952', hasData:false},
        {label:'West Vancouver', slug:'west-vancouver-13', city:'West Vancouver', address:'2100 Park Royal S, West Vancouver, BC', storeNumber:'13', hasData:false},
        {label:'South Vancouver', slug:'south-vancouver-994', city:'Vancouver', address:'8133 Ontario St., Vancouver, BC', storeNumber:'994', hasData:false},
        {label:'Richmond', slug:'richmond-941', city:'Richmond', address:'5300 No. 3 Rd., Unit 700, Richmond, BC', storeNumber:'941', hasData:false},
        {label:'Best Buy Mobile Richmond Centre', slug:'best-buy-mobile-richmond-centre-228', city:'Richmond', address:'6551 No. 3 Rd., Unit 1111B, Richmond, BC', storeNumber:'228', hasData:false},
        {label:'Best Buy Express Kiosk Vancouver International Airport', slug:'best-buy-express-kiosk-vancouver-international-airport-850', city:'Richmond', address:'3211 Grant McConachie Way, Richmond, BC', storeNumber:'850', hasData:false},
        {label:'Best Buy Express Kiosk Vancouver International Airport', slug:'best-buy-express-kiosk-vancouver-international-airport-852', city:'Richmond', address:'3211 Grant McConachie Way, Richmond, BC', storeNumber:'852', hasData:false},
        {label:'Best Buy Express Kiosk Vancouver International Airport', slug:'best-buy-express-kiosk-vancouver-international-airport-853', city:'Richmond', address:'3211 Grant McConachie Way, Richmond, BC', storeNumber:'853', hasData:false},
        {label:'Best Buy Express Kiosk Vancouver International Airport', slug:'best-buy-express-kiosk-vancouver-international-airport-854', city:'Richmond', address:'3211 Grant McConachie Way, Richmond, BC', storeNumber:'854', hasData:false},
        {label:'Best Buy Express Kiosk Tsawwassen Marketplace', slug:'best-buy-express-kiosk-tsawwassen-marketplace-826', city:'Delta', address:'1 Ferry Causeway, Delta, BC', storeNumber:'826', hasData:false},
        {label:'Best Buy Express Kiosk BC Ferries - Spirit of BC', slug:'best-buy-express-kiosk-bc-ferries-spirit-of-bc-829', city:'Delta', address:'1 Ferry Causeway, Delta, BC', storeNumber:'829', hasData:false},
        {label:'Best Buy Express Kiosk UBC AMS Student Nest', slug:'best-buy-express-kiosk-ubc-ams-student-nest-825', city:'Vancouver', address:'6133 University Blvd., Vancouver, BC', storeNumber:'825', hasData:false},
        {label:'UBC Best Buy Mobile Pop-Up', slug:'ubc-best-buy-mobile-pop-up-911', city:'Vancouver', address:'6200 University Boulevard, Vancouver, BC', storeNumber:'911', hasData:false},
        {label:'Best Buy Express Kiosk BC Ferries - Spirit of Vancouver Island', slug:'best-buy-express-kiosk-bc-ferries-spirit-of-vancouver-island-828', city:'North Saanich', address:'Patricia Bay Highway, North Saanich, BC', storeNumber:'828', hasData:false},
        {label:'Best Buy Mobile Mayfair Shopping Centre', slug:'best-buy-mobile-mayfair-shopping-centre-239', city:'Victoria', address:'3147 Douglas St., Unit 344, Victoria, BC', storeNumber:'239', hasData:false},
        {label:'Victoria', slug:'victoria-10', city:'Victoria', address:'3450 Uptown Blvd., Suite 200, Victoria, BC', storeNumber:'10', hasData:false},
        {label:'Langford', slug:'langford-702', city:'Victoria', address:'779 McCallum Dr., Victoria, BC', storeNumber:'702', hasData:false},
        {label:'Cowichan', slug:'cowichan-708', city:'Duncan', address:'2900 Drinkwater Rd. , Unit 101, Duncan, BC', storeNumber:'708', hasData:false},
        {label:'Nanaimo', slug:'nanaimo-9', city:'Nanaimo', address:'3200 North Island Hwy, Unit 87, Nanaimo, BC', storeNumber:'9', hasData:false},
        {label:'Best Buy Mobile Woodgrove Centre', slug:'best-buy-mobile-woodgrove-centre-240', city:'Nanaimo', address:'6631 Island Hwy. N, Unit 52, Nanaimo, BC', storeNumber:'240', hasData:false},
        {label:'Courtenay', slug:'courtenay-706', city:'Courtenay', address:'3245 Cliffe Ave., Bldg. D Unit 1, Courtenay, BC', storeNumber:'706', hasData:false}
      ];
    }

    const DEFAULT_BRANCH_SLUGS = new Set([
      ...baseBranches().map(branch => branch.slug),
      'lachute',
      'en-ligne',
      'st-jerome',
      'montreal-best-buy',
      'laval-best-buy'
    ]);

    const WALMART_QUEBEC_BRANCHES = [
      {label: 'ST JEROME ‚Äî Walmart #7147', slug: 'saint-jerome', city: 'St. Jerome', address: '1045 boul du grand heron, St. Jerome, QC, J7Y 3P2', distanceKm: 3.0, hasData: true},
      {label: 'BLAINVILLE ‚Äî Walmart Supercentre', slug: 'blainville', city: 'Blainville', address: '1313 boul Mich√®le-Bohec, Blainville, QC, J7C 0M4', distanceKm: 0.0, hasData: true},
      {label: 'LACHUTE ‚Äî Walmart Supercentre', slug: 'lachute', city: 'Lachute', address: '540 Rue Berry, Lachute, QC, J8H 4N5', distanceKm: 34.0, hasData: true}
    ];

    const HOME_DEPOT_CANADA_BRANCHES = WALMART_QUEBEC_BRANCHES.filter(branch => branch.slug !== 'online-7274').map(branch => {
      const hasData = ['saint-jerome'].includes(branch.slug);
      return {
        ...branch,
        label: branch.label.replace('Walmart', 'Home Depot'),
        hasData
      };
    });

    const CANADIAN_TIRE_BRANCHES = baseBranches().map(branch => ({
      ...branch,
      ...(branch.slug === 'laval'
        ? { label: 'Laval ‚Äî 1450 Boul. le Corbusier', address: '1450 Boul. le Corbusier, Laval, QC' }
        : {}),
      hasData: branch.slug === 'saint-jerome' || branch.slug === 'blainville'
    }));

    const STORES = [
      {label:'Walmart', slug:'walmart', branches: WALMART_QUEBEC_BRANCHES},
      {label:'Best Buy', slug:'best-buy', branches: fullBestBuyBranches()},
      {label:'Canadian Tire', slug:'canadian-tire', branches: CANADIAN_TIRE_BRANCHES},
      {label:'Patrick Morin', slug:'patrick-morin', branches: patrickMorinBranches()},
      {label:'Rona', slug:'rona', branches: baseBranches()},
      {label:'Sporting Life', slug:'sporting-life', branches: baseBranches()}
    ];

    function formatBranchCoverage(branches){
      const count = Array.isArray(branches) ? branches.length : 0;
      if(count <= 0) return '';
      const suffix = count > 1 ? 's' : '';
      return `${count} succursale${suffix} suivie${suffix}`;
    }

    const USA_STORE_MENU = [
      {label:'Amazon Warehouse', description:'Lots of returns and refurbished inventory'},
      {label:'Best Buy USA', description:'Electronics, appliances and gaming'},
      {label:'Home Depot US', description:'Home improvement and tools'},
      {label:'Walmart US', description:'Big-box retail and dry grocery'},
      {label:'Target', description:'Lifestyle, home and private-label exclusives'},
      {label:'Lowe‚Äôs', description:'Renovation supplies and gardening'},
      {label:'Costco Wholesale', description:'Lots en gros propices au FBA'},
      {label:'Sam‚Äôs Club', description:'Bulk opportunities for resale'},
      {label:'Kohl‚Äôs', description:'Mode, maison et items saisonniers'},
      {label:"BJ's Wholesale Club", description:'Fast-moving regional inventory'}
    ];

    let storeAdsRotationTimer = null;

    function stopStoreAdsRotation(){
      if(storeAdsRotationTimer){
        clearInterval(storeAdsRotationTimer);
        storeAdsRotationTimer = null;
      }
    }

    function startStoreAdsRotation(callback){
      stopStoreAdsRotation();
      storeAdsRotationTimer = window.setInterval(callback, 4500);
    }

    function renderStoreAds(){
      if(!storeAdsContainer) return;
      stopStoreAdsRotation();
      const items = STORES
        .map(store => {
          const label = store?.label;
          if(!label) return null;
          return {
            label,
            coverage: formatBranchCoverage(store?.branches)
          };
        })
        .filter(Boolean);
      if(items.length === 0){
        storeAdsContainer.setAttribute('aria-hidden', 'true');
        storeAdsContainer.innerHTML = '';
        storeAdsContainer.classList.remove('store-ads--static');
        storeAdsContainer.onmouseenter = null;
        storeAdsContainer.onmouseleave = null;
        storeAdsContainer.onfocusin = null;
        storeAdsContainer.onfocusout = null;
        return;
      }
      const list = items.map((item, index) => {
        const coverage = item.coverage ? `<span class="store-ads-coverage">${item.coverage}</span>` : '';
        const isActive = index === 0;
        return `<div class="store-ads-item${isActive ? ' is-active' : ''}" role="group" aria-hidden="${isActive ? 'false' : 'true'}"><span class="store-ads-name">${item.label}</span>${coverage}</div>`;
      }).join('');
      const dots = items.length > 1
        ? `<div class="store-ads-dots" role="presentation">${items.map((_, index) => `<span class="store-ads-dot${index === 0 ? ' is-active' : ''}" aria-hidden="true"></span>`).join('')}</div>`
        : '';
      storeAdsContainer.innerHTML = `
        <div class="store-ads-header">Stores en vedette</div>
        <div class="store-ads-spotlight">${list}</div>
        ${dots}
      `;
      storeAdsContainer.removeAttribute('aria-hidden');

      const slides = Array.from(storeAdsContainer.querySelectorAll('.store-ads-item'));
      const dotEls = Array.from(storeAdsContainer.querySelectorAll('.store-ads-dot'));
      if(slides.length === 0) return;

      const shouldReduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      if(shouldReduceMotion){
        storeAdsContainer.classList.add('store-ads--static');
        slides.forEach(slide => {
          slide.classList.add('is-active');
          slide.setAttribute('aria-hidden', 'false');
        });
        stopStoreAdsRotation();
        storeAdsContainer.onmouseenter = null;
        storeAdsContainer.onmouseleave = null;
        storeAdsContainer.onfocusin = null;
        storeAdsContainer.onfocusout = null;
        return;
      }

      storeAdsContainer.classList.remove('store-ads--static');

      let activeIndex = 0;

      function showSlide(nextIndex){
        activeIndex = nextIndex % slides.length;
        slides.forEach((slide, idx) => {
          const isActive = idx === activeIndex;
          slide.classList.toggle('is-active', isActive);
          slide.setAttribute('aria-hidden', isActive ? 'false' : 'true');
        });
        dotEls.forEach((dot, idx) => {
          dot.classList.toggle('is-active', idx === activeIndex);
        });
      }

      showSlide(0);

      if(slides.length > 1){
        const advance = () => showSlide(activeIndex + 1);
        startStoreAdsRotation(advance);

        const resume = () => startStoreAdsRotation(advance);

        storeAdsContainer.onmouseenter = stopStoreAdsRotation;
        storeAdsContainer.onfocusin = stopStoreAdsRotation;
        storeAdsContainer.onmouseleave = resume;
        storeAdsContainer.onfocusout = resume;
      }else{
        storeAdsContainer.onmouseenter = null;
        storeAdsContainer.onfocusin = null;
        storeAdsContainer.onmouseleave = null;
        storeAdsContainer.onfocusout = null;
      }
    }

    renderStoreAds();

    const POSTAL_DIRECTORY = [
      {
        branchSlug:'montreal',
        cityLabel:'Montreal (Island)',
        prefixes:[
          'H1A','H1B','H1C','H1E','H1G','H1H','H1J','H1K','H1L','H1M','H1N','H1P','H1R','H1S','H1T','H1V','H1W','H1X','H1Y','H1Z',
          'H2A','H2B','H2C','H2E','H2G','H2H','H2J','H2K','H2L','H2M','H2N','H2P','H2R','H2S','H2T','H2V','H2W','H2X','H2Y','H2Z',
          'H3A','H3B','H3C','H3E','H3G','H3H','H3J','H3K','H3L','H3M','H3N','H3R','H3S','H3T','H3V','H3W','H3X','H3Y','H3Z',
          'H4A','H4B','H4C','H4E','H4G','H4H','H4J','H4K','H4L','H4M','H4N','H4P','H4R','H4S','H4T','H4V','H4W','H4X',
          'H8N','H8P','H8R','H8S','H8T','H8Y','H8Z','H9A','H9B','H9C','H9E','H9G','H9H','H9J','H9K','H9P','H9R','H9S','H9W','H9X',
          'J0P'
        ]
      },
      {
        branchSlug:'laval',
        cityLabel:'Laval',
        prefixes:[
          'H7A','H7B','H7C','H7E','H7G','H7H','H7J','H7K','H7L','H7M','H7N','H7P','H7R','H7S','H7T','H7V','H7W','H7X','H7Y','H7Z',
          'H8N','H8P','H8R','H8T','H8Y'
        ]
      },
      {
        branchSlug:'saint-jerome',
        cityLabel:'Saint-J√©r√¥me',
        prefixes:['J5L','J7Y','J7Z','J8A']
      },
      {
        branchSlug:'blainville',
        cityLabel:'Blainville',
        prefixes:['J7B','J7C']
      },
      {
        branchSlug:'lachute',
        cityLabel:'Lachute',
        prefixes:['J8H','J8G']
      }
    ];

    const searchInput = document.getElementById('searchInput');
    const storeSelect = document.getElementById('storeSelect');
    const citySelect  = document.getElementById('citySelect');
    const range       = document.getElementById('discountRange');
    const rangeLabel  = document.getElementById('discountValue');
    const cardsEl     = document.getElementById('cards');
    const countEl     = document.getElementById('resultCount');
    const btnClear    = document.getElementById('btnClear');
    const devError    = document.getElementById('devError');
    const postalInput = document.getElementById('postalInput');
    const postalHelper = document.getElementById('postalHelper');
    const countryButtons = Array.from(document.querySelectorAll('.country-button[data-country]'));
    const countryLabel = document.querySelector('[data-country-label]');
    const exchangeIndicator = document.querySelector('[data-exchange-indicator]');

    const DEFAULT_POSTAL_MESSAGE = 'Enter the first three characters of the postal code to find branches within a 50 km radius (e.g. H2X).';
    const BASE_CURRENCY = { code:'CAD', locale:'en-CA' };
    const PLACEHOLDER_IMAGE = 'https://via.placeholder.com/400x300?text=Liquidation';
    const AMAZON_DAILY_PATH = 'data/amazon_ca_daily.json';
    const AMAZON_FALLBACK_PATH = 'data/amazon/canada.json';
    // currency.cadToLocalRate indique la conversion d'un dollar canadien vers la devise locale.
    const COUNTRY_CONFIG = {
      canada: {
        titleSuffix: 'Canada',
        postalMessage: DEFAULT_POSTAL_MESSAGE,
        emptyNotice: 'Select a store to view the Canadian clearance deals available right now.',
        hideStoreMenu: true,
        currency: {
          code: 'CAD',
          locale: 'en-CA',
          cadToLocalRate: 1
        },
        amazonDomain: 'www.amazon.ca'
      },
      usa: {
        titleSuffix: 'United States',
        postalMessage: 'Filters will activate as soon as the US platform launches.',
        emptyNotice: 'We are finalising our US catalogue. Check back soon to discover the best American deals.',
        storeMenuTitle: 'Stores covered at the US launch',
        storeMenuDescription: 'These banners will join our US clearance radar as soon as we officially launch.',
        storeMenu: USA_STORE_MENU,
        currency: {
          code: 'USD',
          locale: 'en-US',
          cadToLocalRate: 0.74
        },
        amazonDomain: 'www.amazon.com'
      },
      europe: {
        titleSuffix: 'Europe',
        postalMessage: 'Search features will be available once the European rollout begins.',
        emptyNotice: 'European coverage is in preparation. Subscribe to be notified of the official launch.',
        currency: {
          code: 'EUR',
          locale: 'fr-FR',
          cadToLocalRate: 0.68
        },
        amazonDomain: 'www.amazon.fr'
      }
    };
    let activeCountry = 'canada';
    let savedFilters = null;
    const DEFAULT_FILTERS = Object.freeze({
      search: '',
      store: '',
      city: '',
      discount: '0'
    });

    const EXCHANGE_FORMATTER = new Intl.NumberFormat('en-CA',{minimumFractionDigits:2,maximumFractionDigits:2});

    function getCountryConfig(country){
      return COUNTRY_CONFIG[country] ?? COUNTRY_CONFIG.canada;
    }

    function getCurrencySettings(country){
      const fallback = COUNTRY_CONFIG.canada?.currency ?? { code: BASE_CURRENCY.code, locale: BASE_CURRENCY.locale, cadToLocalRate: 1 };
      const config = COUNTRY_CONFIG[country];
      if(config && config.currency){
        return {...fallback, ...config.currency};
      }
      return fallback;
    }

    function formatExchange(baseCode, targetCode, rate){
      const normalizedRate = Number.isFinite(rate) && rate > 0 ? rate : 1;
      const direct = EXCHANGE_FORMATTER.format(normalizedRate);
      const inverse = normalizedRate > 0 ? EXCHANGE_FORMATTER.format(1 / normalizedRate) : null;
      const baseText = `1 ${baseCode} ‚âà ${direct} ${targetCode}`;
      const inverseText = inverse ? `1 ${targetCode} ‚âà ${inverse} ${baseCode}` : '';
      return { baseText, inverseText, directValue: direct, inverseValue: inverse };
    }

    function updateExchangeIndicator(){
      if(!exchangeIndicator) return;
      const settings = getCurrencySettings(activeCountry);
      const baseCode = BASE_CURRENCY.code;
      const targetCode = settings.code || baseCode;
      const rate = Number(settings.cadToLocalRate);
      const normalizedRate = Number.isFinite(rate) && rate > 0 ? rate : 1;
      if(activeCountry === 'canada'){
        const segments = [];
        const ariaSegments = [];
        const usdSettings = getCurrencySettings('usa');
        const usdCode = usdSettings.code || 'USD';
        const usdRate = Number(usdSettings.cadToLocalRate);
        if(usdCode && usdCode !== baseCode && Number.isFinite(usdRate) && usdRate > 0){
          const { baseText, inverseText, directValue, inverseValue } = formatExchange(baseCode, usdCode, usdRate);
          segments.push(baseText);
          if(inverseText){
            segments.push(inverseText);
          }
          ariaSegments.push(`1 ${baseCode} pour environ ${directValue} ${usdCode}`);
          if(inverseText && inverseValue){
            ariaSegments.push(`1 ${usdCode} pour environ ${inverseValue} ${baseCode}`);
          }
        }
        if(segments.length === 0){
          segments.push(`1 ${baseCode} = 1 ${baseCode}`);
          ariaSegments.push(`1 ${baseCode} pour 1 ${baseCode}`);
        }
        exchangeIndicator.textContent = segments.join(' ¬∑ ');
        exchangeIndicator.setAttribute('aria-label', `Taux de change ${ariaSegments.join(' et ')}`);
        return;
      }
      if(Math.abs(normalizedRate - 1) < 1e-6){
        exchangeIndicator.textContent = `1 ${baseCode} = 1 ${baseCode}`;
        exchangeIndicator.setAttribute('aria-label', `Taux de change 1 ${baseCode} pour 1 ${baseCode}`);
        return;
      }
      const { baseText, inverseText } = formatExchange(baseCode, targetCode, normalizedRate);
      const combined = inverseText ? `${baseText} ¬∑ ${inverseText}` : baseText;
      exchangeIndicator.textContent = combined;
      const ariaText = inverseText ? `${baseText} et ${inverseText}` : baseText;
      exchangeIndicator.setAttribute('aria-label', `Taux de change ${ariaText}`);
    }

    function updateCountryMeta(){
      const config = getCountryConfig(activeCountry);
      document.title = `EconoDeal ‚Äî ${config.titleSuffix}`;
      if(countryLabel){
        const currency = getCurrencySettings(activeCountry);
        const currencyPart = currency?.code ? ` ¬∑ Devise¬†: ${currency.code}` : '';
        countryLabel.textContent = `Pays couvert¬†: ${config.titleSuffix}${currencyPart}`;
      }
      updateExchangeIndicator();
    }

    function updateCountryButtons(){
      for(const button of countryButtons){
        const isActive = button.dataset.country === activeCountry;
        button.classList.toggle('active', isActive);
        button.setAttribute('aria-pressed', isActive ? 'true' : 'false');
      }
    }

    function setFiltersDisabled(disabled){
      const elements = [searchInput, storeSelect, citySelect, postalInput, range, btnClear];
      for(const el of elements){
        if(!el) continue;
        if(disabled){
          el.setAttribute('disabled', 'disabled');
        }else{
          el.removeAttribute('disabled');
        }
        if(el !== btnClear){
          if(disabled){
            el.setAttribute('aria-disabled', 'true');
          }else{
            el.removeAttribute('aria-disabled');
          }
        }
      }
      if(btnClear){
        if(disabled){
          btnClear.setAttribute('aria-disabled', 'true');
        }else{
          btnClear.removeAttribute('aria-disabled');
        }
      }
    }

    function populateStoreSelect(country){
      if(!storeSelect) return;
      const options = ['<option value="">(All)</option>'];
      if(country === 'canada'){
        for(const store of STORES){
          const label = store?.label;
          const value = store?.slug;
          if(!label || !value) continue;
          const option = `<option value="${value}">${label}</option>`;
          options.push(option);
        }
      }else{
        const config = getCountryConfig(country);
        const menu = Array.isArray(config?.storeMenu) ? config.storeMenu : [];
        for(const entry of menu){
          const label = entry?.label;
          if(!label) continue;
          const value = entry?.slug || slugify(label || '');
          const option = `<option value="${value}" disabled>${label}</option>`;
          options.push(option);
        }
      }
      storeSelect.innerHTML = options.join('');
    }

    function setCountry(country){
      const isKnown = Object.prototype.hasOwnProperty.call(COUNTRY_CONFIG, country);
      const next = isKnown ? country : 'canada';
      if(next === activeCountry) return;

      if(activeCountry === 'canada'){
        savedFilters = {
          search: searchInput?.value || '',
          store: storeSelect?.value || '',
          city: citySelect?.value || '',
          discount: range?.value || '0'
        };
      }

      activeCountry = next;
      populateStoreSelect(activeCountry);
      updateCountryButtons();
      updateCountryMeta();

      if(activeCountry !== 'canada'){
        const config = getCountryConfig(activeCountry);
        setFiltersDisabled(true);
        resetPostalFilter();
        postalBranchSlugs = null;
        if(storeSelect){
          storeSelect.value = '';
          const hasPreviewMenu = Array.isArray(config?.storeMenu) && config.storeMenu.some(item => item && item.label);
          if(hasPreviewMenu){
            storeSelect.removeAttribute('disabled');
            storeSelect.setAttribute('aria-disabled', 'true');
            storeSelect.dataset.preview = 'true';
          }
        }
        setCityOptions('', false);
        if(citySelect){
          citySelect.value = '';
        }
        if(range){
          range.value = 0;
        }
        updatePostalHelper(config.postalMessage, false);
        deals.length = 0;
        render();
        return;
      }

      setFiltersDisabled(false);
      if(storeSelect){
        delete storeSelect.dataset.preview;
      }
      const filters = savedFilters ?? DEFAULT_FILTERS;
      const initialStore = getStoreByIdentifier(filters.store);
      const storeValue = initialStore?.slug || '';
      if(searchInput){
        searchInput.value = filters.search || '';
      }
      if(storeSelect){
        storeSelect.value = storeValue;
      }
      setCityOptions(storeValue, false);
      if(citySelect){
        const options = Array.from(citySelect.options || []);
        const hasCity = options.some(option => option.value === (filters.city || ''));
        citySelect.value = hasCity ? (filters.city || '') : '';
      }
      if(range){
        range.value = filters.discount || 0;
      }
      postalBranchSlugs = null;
      updatePostalHelper(DEFAULT_POSTAL_MESSAGE, false);
      fetchData();
    }

    updateCountryButtons();
    updateCountryMeta();
    setFiltersDisabled(false);
    populateStoreSelect(activeCountry);

    for(const button of countryButtons){
      button.addEventListener('click', () => {
        setCountry(button.dataset.country);
      });
    }
    const POSTAL_RADIUS_KM = 50;

    const BRANCH_COORDINATES = {
      'montreal': {lat:45.5019, lng:-73.5674},
      'laval': {lat:45.6066, lng:-73.7124},
      'saint-jerome': {lat:45.7811, lng:-74.0036},
      'blainville': {lat:45.6787, lng:-73.8736},
      'lachute': {lat:45.6510, lng:-74.3310}
    };

    let postalBranchSlugs = null;

    function toRadians(value){
      return value * Math.PI / 180;
    }

    function haversineDistanceKm(lat1, lon1, lat2, lon2){
      const R = 6371;
      const dLat = toRadians(lat2 - lat1);
      const dLon = toRadians(lon2 - lon1);
      const a = Math.sin(dLat / 2) ** 2 + Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.sin(dLon / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function findNearbyBranches(referenceSlug, radiusKm){
      if(!referenceSlug) return [];
      const origin = BRANCH_COORDINATES[referenceSlug];
      if(!origin) return [];
      const branches = baseBranches();
      const nearby = [];
      for(const branch of branches){
        const coords = BRANCH_COORDINATES[branch.slug];
        if(!coords) continue;
        const distance = haversineDistanceKm(origin.lat, origin.lng, coords.lat, coords.lng);
        if(distance <= radiusKm){
          nearby.push({...branch, distance});
        }
      }
      return nearby.sort((a,b) => a.distance - b.distance);
    }

    function normalizePostal(value){
      if(!value) return '';
      return String(value).toUpperCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^A-Z0-9]/g,'');
    }

    function findPostalMatch(normalized){
      if(!normalized) return null;
      return POSTAL_DIRECTORY.find(entry => entry.prefixes.some(prefix => normalized.startsWith(prefix)));
    }

    function updatePostalHelper(message, isError){
      if(!postalHelper) return;
      postalHelper.textContent = message;
      postalHelper.classList.toggle('error', Boolean(isError));
    }

    function resetPostalFilter(){
      if(!postalInput) return;
      postalInput.value = '';
      postalInput.removeAttribute('aria-invalid');
      updatePostalHelper(DEFAULT_POSTAL_MESSAGE, false);
      const hadFilter = postalBranchSlugs && postalBranchSlugs.size > 0;
      postalBranchSlugs = null;
      if(hadFilter){
        setCityOptions(storeSelect?.value ?? '', true);
      }
    }

    async function applyPostalSearch(raw){
      if(!postalInput) return;
      if(activeCountry !== 'canada') return;
      const hadFilter = postalBranchSlugs && postalBranchSlugs.size > 0;
      const normalized = normalizePostal(raw);
      if(!normalized){
        postalInput.removeAttribute('aria-invalid');
        updatePostalHelper(DEFAULT_POSTAL_MESSAGE, false);
        if(hadFilter){
          postalBranchSlugs = null;
          setCityOptions(storeSelect?.value ?? '', true);
          if(citySelect){
            citySelect.value = '';
          }
          await fetchData();
        }
        return;
      }
      if(normalized.length < 3){
        postalInput.setAttribute('aria-invalid','true');
        updatePostalHelper('Enter at least the first three characters of the postal code.', true);
        if(hadFilter){
          postalBranchSlugs = null;
          setCityOptions(storeSelect?.value ?? '', true);
          if(citySelect){
            citySelect.value = '';
          }
          await fetchData();
        }
        return;
      }
      const match = findPostalMatch(normalized);
      if(!match){
        postalInput.setAttribute('aria-invalid','true');
        updatePostalHelper('Postal code non reconnu dans les succursales couvertes.', true);
        if(hadFilter){
          postalBranchSlugs = null;
          setCityOptions(storeSelect?.value ?? '', true);
          if(citySelect){
            citySelect.value = '';
          }
          await fetchData();
        }
        return;
      }
      postalInput.removeAttribute('aria-invalid');
      const nearbyBranches = findNearbyBranches(match.branchSlug, POSTAL_RADIUS_KM);
      const nextSlugs = new Set(nearbyBranches.map(branch => branch.slug));
      if(nextSlugs.size === 0){
        nextSlugs.add(match.branchSlug);
      }
      let changed = nextSlugs.size !== (postalBranchSlugs?.size ?? 0);
      if(!changed && postalBranchSlugs){
        for(const slug of nextSlugs){
          if(!postalBranchSlugs.has(slug)){
            changed = true;
            break;
          }
        }
      }
      postalBranchSlugs = nextSlugs;
      if(changed){
        setCityOptions(storeSelect?.value ?? '', true);
        if(citySelect && citySelect.value && !postalBranchSlugs.has(citySelect.value)){
          citySelect.value = '';
        }
      }
      const helperBranches = nearbyBranches.length ? nearbyBranches : [{label: match.cityLabel}];
      const helperList = helperBranches.map(branch => branch.label).join(', ');
      updatePostalHelper(`Branches within ${POSTAL_RADIUS_KM} km: ${helperList}.`, false);
      await fetchData();
    }

    if(postalInput){
      resetPostalFilter();
      let postalDebounce;
      postalInput.addEventListener('input', () => {
        clearTimeout(postalDebounce);
        const value = postalInput.value;
        postalDebounce = setTimeout(() => { applyPostalSearch(value); }, 300);
      });
      postalInput.addEventListener('blur', () => { applyPostalSearch(postalInput.value); });
      postalInput.addEventListener('keydown', (event) => {
        if(event.key === 'Enter'){
          event.preventDefault();
          applyPostalSearch(postalInput.value);
        }
      });
    }

    // Display the year
    const y = new Date().getFullYear();
    document.getElementById('year').textContent = y;
    document.getElementById('yearFooter').textContent = y;

    function toNumber(value){
      if(typeof value === 'number' && Number.isFinite(value)) return value;
      if(typeof value === 'string' && value.trim()){
        const parsed = Number(value.replace(/[^0-9,.-]/g,'').replace(',','.'));
        return Number.isFinite(parsed) ? parsed : null;
      }
      return null;
    }

    function collectNumbers(...values){
      const results = [];
      for(const value of values){
        if(Array.isArray(value)){
          value.forEach(entry => {
            const parsed = toNumber(entry);
            if(Number.isFinite(parsed) && parsed > 0) results.push(parsed);
          });
          continue;
        }
        if(value && typeof value === 'object'){
          const objectCandidates = [value.value, value.amount, value.price, value.salePrice, value.current, value.lowest, value.highest];
          objectCandidates.forEach(candidate => {
            const parsed = toNumber(candidate);
            if(Number.isFinite(parsed) && parsed > 0) results.push(parsed);
          });
          continue;
        }
        const parsed = toNumber(value);
        if(Number.isFinite(parsed) && parsed > 0) results.push(parsed);
      }
      return results;
    }

    function normalizeImageCandidate(value){
      if(!value) return null;
      if(Array.isArray(value)){
        for(const entry of value){
          const normalized = normalizeImageCandidate(entry);
          if(normalized) return normalized;
        }
        return null;
      }
      if(typeof value === 'object'){
        const potentialKeys = ['url','href','src','image','large','medium','small','default'];
        for(const key of potentialKeys){
          if(value[key]){
            const normalized = normalizeImageCandidate(value[key]);
            if(normalized) return normalized;
          }
        }
        return null;
      }
      const stringValue = String(value).trim();
      if(!stringValue || stringValue === '#' || stringValue.toLowerCase() === 'null' || stringValue.toLowerCase() === 'n/a') return null;
      if(stringValue.startsWith('//')) return `https:${stringValue}`;
      if(/^https?:\/\//i.test(stringValue) || stringValue.startsWith('data:image')) return stringValue;
      return null;
    }

    function resolveImage(item){
      const candidates = [
        item.image,
        item.image_url,
        item.imageUrl,
        item.img,
        item.primary_image,
        item.primaryImage,
        item.image_link,
        item.imageLink,
        item.thumbnail,
        item.thumbnail_url,
        item.thumbnailUrl,
        item.product_image,
        item.productImage,
        item.images,
        item.media
      ];
      for(const candidate of candidates){
        const normalized = normalizeImageCandidate(candidate);
        if(normalized) return normalized;
      }
      return PLACEHOLDER_IMAGE;
    }

    function resolvePrices(item){
      const regularCandidates = collectNumbers(
        item.original_price,
        item.originalPrice,
        item.regular_price,
        item.regularPrice,
        item.price_before,
        item.priceBefore,
        item.list_price,
        item.listPrice,
        item.compare_at_price,
        item.compareAtPrice,
        item.msrp,
        item.price
      );
      const saleCandidates = collectNumbers(
        item.salePrice,
        item.sale_price,
        item.discount_price,
        item.discountPrice,
        item.current_price,
        item.currentPrice,
        item.offer_price,
        item.offerPrice,
        item.deal_price,
        item.dealPrice,
        item.price
      );
      let regular = regularCandidates.length ? Math.max(...regularCandidates) : null;
      let sale = saleCandidates.length ? Math.min(...saleCandidates) : null;
      if(regular === null && sale !== null){
        regular = saleCandidates.length > 1 ? Math.max(...saleCandidates) : sale;
      }
      if(sale === null && regular !== null){
        sale = regularCandidates.length > 1 ? Math.min(...regularCandidates) : regular;
      }
      if(regular !== null && sale !== null && sale > regular){
        const combined = [...regularCandidates, ...saleCandidates].filter(n => Number.isFinite(n));
        if(combined.length){
          combined.sort((a,b) => a - b);
          sale = combined[0];
          regular = combined[combined.length - 1];
        }else{
          const swap = sale;
          sale = regular;
          regular = swap;
        }
      }
      return {
        regular: regular ?? 0,
        sale: sale ?? (regular ?? 0)
      };
    }

    function firstDefined(...values){
      for(const value of values){
        if(value !== undefined && value !== null && value !== '') return value;
      }
      return null;
    }

    function slugify(value){
      if(value === undefined || value === null) return '';
      const text = String(value).normalize('NFD').replace(/[\u0300-\u036f]/g, '');
      return text.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').replace(/--+/g,'-');
    }

    function normalizeSearchText(value){
      if(value === undefined || value === null) return '';
      const text = String(value)
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .toLowerCase()
        .replace(/[^a-z0-9\s]/g, ' ')
        .replace(/\s+/g, ' ')
        .trim();
      return text;
    }

    function buildSearchIndex(...segments){
      return segments
        .map(segment => normalizeSearchText(segment))
        .filter(Boolean)
        .join(' ');
    }

    function tokenizeSearchIndex(value){
      if(typeof value !== 'string' || !value) return [];
      return value.split(' ').filter(Boolean);
    }

    function ensureSearchIndex(deal){
      if(!deal || typeof deal !== 'object') return '';
      const existing = typeof deal.searchIndex === 'string' ? deal.searchIndex : '';
      if(existing){
        if(!Array.isArray(deal.searchTokens)){
          deal.searchTokens = tokenizeSearchIndex(existing);
        }
        return existing;
      }
      const regenerated = buildSearchIndex(
        deal.title,
        deal.store,
        deal.branch,
        deal.city,
        deal.brand,
        deal.model,
        deal.sku,
        deal.asin,
        deal.searchKeywords
      );
      deal.searchIndex = regenerated;
      deal.searchTokens = tokenizeSearchIndex(regenerated);
      return regenerated;
    }

    function ensureSearchTokens(deal){
      if(!deal || typeof deal !== 'object') return [];
      if(Array.isArray(deal.searchTokens)) return deal.searchTokens;
      const index = ensureSearchIndex(deal);
      const tokens = tokenizeSearchIndex(index);
      deal.searchTokens = tokens;
      return tokens;
    }

    function ensureTitleTokens(deal){
      if(!deal || typeof deal !== 'object') return [];
      if(Array.isArray(deal.titleTokens)) return deal.titleTokens;
      const normalized = normalizeSearchText(deal.title);
      const tokens = tokenizeSearchIndex(normalized);
      deal.titleTokens = tokens;
      return tokens;
    }

    function normalizeDeal(item, storeLabel, branch){
      const branchLabel = typeof branch === 'object' && branch ? branch.label : branch;
      const branchSlug = typeof branch === 'object' && branch && branch.slug ? branch.slug : slugify(branchLabel || item.city || storeLabel);
      const cityLabel = typeof branch === 'object' && branch && branch.city ? branch.city : firstDefined(item.city, branchLabel, storeLabel);
      const citySlug = slugify(cityLabel);
      const {regular: finalRegular, sale: finalSale} = resolvePrices(item);

      const brand = firstDefined(
        item.brand,
        item.manufacturer,
        item.maker,
        item.vendor,
        item.brandName,
        item.brand_name
      );

      const model = firstDefined(
        item.model,
        item.modelNumber,
        item.model_number,
        item.modelNo,
        item.model_no,
        item.partNumber,
        item.part_number,
        item.mpn
      );

      const sku = firstDefined(
        item.sku,
        item.productCode,
        item.product_code,
        item.productId,
        item.product_id,
        item.itemNumber,
        item.item_number,
        item.id
      );

      const asin = firstDefined(item.asin, item.ASIN);

      const searchKeywords = firstDefined(
        item.searchKeywords,
        item.search_keywords,
        item.keywords,
        item.keyword
      );

      const amazonUrl = firstDefined(
        item.amazonUrl,
        item.amazon_url,
        item.amazonLink,
        item.amazon_link
      );

      const title = firstDefined(item.title, item.name, item.product_name, item.productName, 'Article en liquidation');
      const cityDisplay = item.city ?? cityLabel;
      const image = resolveImage(item);
      const searchIndex = buildSearchIndex(
        title,
        storeLabel,
        branchLabel,
        cityDisplay,
        brand,
        model,
        sku,
        asin,
        searchKeywords
      );

      const searchTokens = tokenizeSearchIndex(searchIndex);
      const titleTokens = tokenizeSearchIndex(normalizeSearchText(title));

      return {
        title,
        image,
        price: finalRegular,
        salePrice: finalSale,
        store: item.store ?? storeLabel,
        city: cityDisplay,
        branch: branchLabel ?? cityLabel,
        branchSlug,
        citySlug,
        url: firstDefined(item.url, item.link, item.product_link, item.productLink, '#'),
        brand,
        model,
        sku,
        asin,
        searchKeywords,
        amazonUrl,
        searchIndex,
        searchTokens,
        titleTokens
      };
    }

    function hasRealImage(deal){
      return Boolean(deal && deal.image && deal.image !== PLACEHOLDER_IMAGE);
    }

    function discount(p,s){
      const price = Number(p);
      const sale = Number(s);
      if(!Number.isFinite(price) || price <= 0) return 0;
      if(!Number.isFinite(sale)) return 0;
      const clampedSale = Math.max(0, sale);
      const pct = Math.round((1 - (clampedSale / price)) * 100);
      return Number.isFinite(pct) ? Math.max(pct, 0) : 0;
    }
    function currency(value){
      const numeric = Number(value);
      if(!Number.isFinite(numeric)) return '‚Äî';
      const settings = getCurrencySettings(activeCountry);
      const rate = Number(settings.cadToLocalRate);
      const normalizedRate = Number.isFinite(rate) && rate > 0 ? rate : 1;
      const converted = numeric * normalizedRate;
      const locale = settings.locale || BASE_CURRENCY.locale;
      const code = settings.code || BASE_CURRENCY.code;
      try{
        return converted.toLocaleString(locale,{style:'currency',currency:code});
      }catch(_err){
        return converted.toLocaleString(BASE_CURRENCY.locale,{style:'currency',currency:BASE_CURRENCY.code});
      }
    }

    const deals = [];

    function renderStoreMenu(config){
      if(!config || config.hideStoreMenu) return '';
      const items = Array.isArray(config.storeMenu) ? config.storeMenu.filter(item => item && item.label) : [];
      if(items.length === 0) return '';
      const title = config.storeMenuTitle || 'Stores couverts';
      const description = config.storeMenuDescription || '';
      const list = items.map(item => {
        const label = item.label;
        const note = item.description ? `<span class="store-menu-note">${item.description}</span>` : '';
        return `<li><span class="store-menu-item" role="text"><span class="store-menu-label">${label}</span>${note}</span></li>`;
      }).join('');
      return `
        <nav class="store-menu" aria-label="${title}">
          <div>
            <h3>${title}</h3>
            ${description ? `<p>${description}</p>` : ''}
          </div>
          <ul class="store-menu-list">${list}</ul>
        </nav>
      `;
    }

    function renderCountryPreview(config){
      const blocks = [];
      if(config?.emptyNotice){
        blocks.push(`<div class="notice-card">${config.emptyNotice}</div>`);
      }
      const menu = renderStoreMenu(config);
      if(menu){
        blocks.push(menu);
      }
      return blocks.length ? `<div class="country-preview">${blocks.join('')}</div>` : '';
    }

    function sanitizeAmazonQuery(value){
      if(typeof value !== 'string' || !value.trim()){
        return 'liquidation';
      }
      const normalized = value
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/[^a-zA-Z0-9\s-]/g, ' ');
      const collapsed = normalized.trim().replace(/\s+/g, ' ');
      if(!collapsed){
        return 'liquidation';
      }
      const words = collapsed.split(' ').slice(0, 8);
      return words.join(' ');
    }

    function getAmazonDomain(country){
      const config = getCountryConfig(country);
      const domain = typeof config?.amazonDomain === 'string' ? config.amazonDomain.trim() : '';
      return domain || 'www.amazon.ca';
    }

    function normalizeAsin(value){
      if(value === undefined || value === null) return '';
      const text = String(value).trim();
      return /^[A-Z0-9]{8,}$/i.test(text) ? text : '';
    }

    function buildAmazonLink(deal){
      const domain = getAmazonDomain(activeCountry);
      if(!deal){
        const fallbackQuery = sanitizeAmazonQuery('liquidation');
        return `https://${domain}/s?k=${encodeURIComponent(fallbackQuery)}&ref=nb_sb_noss`;
      }

      const asin = normalizeAsin(deal.asin);
      if(asin){
        return `https://${domain}/dp/${encodeURIComponent(asin)}`;
      }

      const segments = [];
      const pushSegment = (value) => {
        if(value === undefined || value === null) return;
        const text = String(value).trim();
        if(text){
          segments.push(text);
        }
      };

      pushSegment(deal.searchKeywords);
      pushSegment(deal.brand);
      pushSegment(deal.model);
      pushSegment(deal.sku);
      pushSegment(deal.title);

      const querySource = segments.join(' ').trim();
      const query = sanitizeAmazonQuery(querySource || deal.title || 'liquidation');
      return `https://${domain}/s?k=${encodeURIComponent(query)}&ref=nb_sb_noss`;
    }

    function render(){
      rangeLabel.textContent = range.value + '%';
      if(activeCountry !== 'canada'){
        const config = getCountryConfig(activeCountry);
        countEl.textContent = '0';
        cardsEl.innerHTML = renderCountryPreview(config);
        return;
      }
      const s = storeSelect.value;
      const c = citySelect.value;
      const query = normalizeSearchText(searchInput?.value || '');
      const terms = query ? query.split(' ') : [];
      const min = parseInt(range.value,10);
      const filtered = deals.filter(d => {
        const pct = discount(d.price,d.salePrice);
        if(s && slugify(d.store || '') !== s) return false;
        if(c && d.branchSlug !== c && d.citySlug !== c) return false;
        const tokens = ensureSearchTokens(d);
        if(terms.length && !terms.every(term => tokens.some(token => token.startsWith(term)))) return false;
        if(terms.length){
          const titleTokens = ensureTitleTokens(d);
          let score = 0;
          for(const term of terms){
            if(titleTokens.some(token => token === term)){
              score += 4;
            }else if(titleTokens.some(token => token.startsWith(term))){
              score += 3;
            }else if(tokens.some(token => token === term)){
              score += 2;
            }else if(tokens.some(token => token.startsWith(term))){
              score += 1;
            }
          }
          d._matchScore = score;
        }else{
          d._matchScore = 0;
        }
        d._discountPct = pct;
        return pct >= min;
      });
      if(terms.length){
        filtered.sort((a,b) => {
          const scoreDiff = (b._matchScore ?? 0) - (a._matchScore ?? 0);
          if(scoreDiff) return scoreDiff;
          const discountDiff = (b._discountPct ?? 0) - (a._discountPct ?? 0);
          if(discountDiff) return discountDiff;
          return (a.salePrice ?? Number.POSITIVE_INFINITY) - (b.salePrice ?? Number.POSITIVE_INFINITY);
        });
      }
      countEl.textContent = filtered.length;
      if(filtered.length === 0){
        const config = getCountryConfig(activeCountry);
        cardsEl.innerHTML = renderCountryPreview(config) || '';
        return;
      }
      cardsEl.innerHTML = filtered.map(d=>{
        const amazonLink = d.amazonUrl || buildAmazonLink(d);
        const ebayLink = d.ebayUrl || `https://www.ebay.ca/sch/i.html?_nkw=${encodeURIComponent(d.title)}`;
        return `
        <article class="card">
          <img src="${d.image}" alt="${d.title}" loading="lazy"/>
          <div class="body">
            <div class="badge">-${discount(d.price,d.salePrice)}% Rabais</div>
            <h3>${d.title}</h3>
            <div class="muted">${d.store} ¬∑ ${d.branch ?? d.city}</div>
            <div class="price"><div class="old">${currency(d.price)}</div><div>${currency(d.salePrice)}</div></div>
            <div class="action-stack">
              <a class="btn btn-primary" href="${d.url||'#'}" target="_blank" rel="noopener noreferrer">Voir</a>
              <div class="comparison-links">
                <a class="btn btn-secondary" href="${amazonLink}" target="_blank" rel="noopener noreferrer">Amazon</a>
                <a class="btn btn-secondary" href="${ebayLink}" target="_blank" rel="noopener noreferrer">eBay</a>
              </div>
            </div>
          </div>
        </article>`;
      }).join('');
    }

    function getStoreBySlug(slug){
      return STORES.find(store => store.slug === slug);
    }

    function getStoreByIdentifier(identifier){
      if(!identifier) return null;
      return getStoreBySlug(identifier) || STORES.find(store => store.label === identifier);
    }

    const BEST_BUY_AGGREGATE_PATH = 'data/best-buy/liquidations.json';

    function filePathFor(store, branch){
      const s = store?.slug;
      const c = branch?.slug;
      if(!s) return null;
      if(s === 'best-buy'){
        if(c === 'en-ligne') return BEST_BUY_AGGREGATE_PATH;
        if(!c) return BEST_BUY_AGGREGATE_PATH;
      }
      if(s === 'amazon'){
        if(c === 'canada') return AMAZON_DAILY_PATH;
        if(!c) return null;
        return `data/${s}/${c}.json`;
      }
      if(!c) return null;
      return `data/${s}/${c}.json`;
    }

    async function loadRonaDirectory(){
      const store = STORES.find(entry => entry.slug === 'rona');
      if(!store) return;
      try{
        const res = await fetch('data/rona/stores.json', {cache:'no-store'});
        if(!res.ok) return;
        const json = await res.json();
        if(!Array.isArray(json)) return;
        const seen = new Map();
        for(const branch of store.branches ?? []){
          if(!branch?.slug) continue;
          seen.set(branch.slug, {...branch, hasData: branch.hasData !== false});
        }
        for(const entry of json){
          if(!entry || typeof entry !== 'object') continue;
          const rawSlug = typeof entry.slug === 'string' && entry.slug ? entry.slug : slugify(entry.label || entry.city || entry.storeNumber);
          if(!rawSlug) continue;
          const label = (entry.label || entry.city || rawSlug).trim();
          const city = (entry.city || label).trim();
          const province = entry.province || '';
          const storeNumber = entry.storeNumber || '';
          const hasData = entry.hasData === true;
          const previous = seen.get(rawSlug) || {};
          seen.set(rawSlug, {
            ...previous,
            label,
            slug: rawSlug,
            city,
            province,
            storeNumber,
            hasData: previous.hasData === true || hasData
          });
        }
        store.branches = Array.from(seen.values()).sort((a,b)=>a.label.localeCompare(b.label,'fr'));
        renderStoreAds();
        if(storeSelect && storeSelect.value === 'rona'){
          setCityOptions('rona', true);
        }
      }catch(err){
        console.warn('Unable to load Rona branches', err);
      }
    }

    function setCityOptions(storeSlug, preserveSelection){
      const previous = preserveSelection ? citySelect.value : '';
      const store = getStoreByIdentifier(storeSlug);
      const branches = store?.branches ?? baseBranches();
      const options = ['<option value="">(All)</option>'];
      const postalFilter = postalBranchSlugs && postalBranchSlugs.size ? postalBranchSlugs : null;
      for(const branch of branches){
        const baseLabel = branch.hasData === false ? `${branch.label} (coming soon)` : branch.label;
        const isNearby = postalFilter ? postalFilter.has(branch.slug) : false;
        const displayLabel = isNearby ? `${baseLabel} ‚Äì nearby` : baseLabel;
        const attrs = [];
        if(branch.hasData === false) attrs.push('data-empty="true"');
        if(isNearby) attrs.push('data-nearby="true"');
        const attrString = attrs.length ? ` ${attrs.join(' ')}` : '';
        options.push(`<option value="${branch.slug}"${attrString}>${displayLabel}</option>`);
      }
      citySelect.innerHTML = options.join('');
      if(preserveSelection && branches.some(branch => branch.slug === previous)){
        citySelect.value = previous;
      }else{
        citySelect.value = '';
      }
    }

    async function fetchAmazonFallback(storeLabel, branch){
      try{
        const res = await fetch(AMAZON_FALLBACK_PATH, {cache:'no-store'});
        if(!res.ok) return [];
        const json = await res.json();
        if(!Array.isArray(json)) return [];
        return json.map(item => normalizeDeal(item, storeLabel, branch));
      }catch(error){
        console.warn('Amazon fallback fetch fail', error);
        return [];
      }
    }

    async function fetchOne(path, storeLabel, branch){
      try{
        const res = await fetch(path, {cache:'no-store'});
        if(!res.ok) return [];
        const json = await res.json();
        if(!Array.isArray(json)) return [];
        const normalized = json.map(item => normalizeDeal(item, storeLabel, branch));
        const needsFallback =
          (normalized.length === 0 || normalized.every(deal => !hasRealImage(deal))) && path === AMAZON_DAILY_PATH;
        if(needsFallback){
          const fallback = await fetchAmazonFallback(storeLabel, branch);
          if(fallback.length && fallback.some(hasRealImage)){
            return fallback;
          }
        }
        return normalized;
      }catch(e){ console.warn('fetch fail', path, e); return []; }
    }

    async function fetchData(){
      if(activeCountry !== 'canada'){
        render();
        return;
      }
      deals.length = 0;
      const storeFilter = storeSelect.value;
      const branchFilter = citySelect.value;
      const postalFilter = postalBranchSlugs && postalBranchSlugs.size ? postalBranchSlugs : null;
      const selectedStores = storeFilter ? [storeFilter] : STORES.map(store => store.slug);
      const tasks = [];
      for(const storeSlug of selectedStores){
        const store = getStoreByIdentifier(storeSlug);
        if(!store) continue;
        let branches = store.branches ?? [];
        if(branchFilter){
          branches = branches.filter(branch => branch.slug === branchFilter);
          if(branches.length === 0) continue;
        }else if(postalFilter){
          const filtered = branches.filter(branch => postalFilter.has(branch.slug));
          if(filtered.length === 0) continue;
          branches = filtered;
        }else if(!storeFilter){
          const defaults = branches.filter(branch => DEFAULT_BRANCH_SLUGS.has(branch.slug));
          branches = defaults.length ? defaults : branches;
        }
        if(branches.length === 0){
          if(postalFilter){
            continue;
          }
          branches = (store.branches ?? []).filter(branch => DEFAULT_BRANCH_SLUGS.has(branch.slug));
        }
        for(const branch of branches){
          if(branch.hasData === false) continue;
          const path = filePathFor(store, branch);
          if(path) tasks.push({store, branch, path});
        }
      }
      const seen = new Set();
      for(const task of tasks){
        if(seen.has(task.path)) continue;
        seen.add(task.path);
        const arr = await fetchOne(task.path, task.store.label, task.branch);
        for(const d of arr){ deals.push(d); }
      }
      render();
    }

    storeSelect.addEventListener('change', () => {
      if(activeCountry !== 'canada') return;
      setCityOptions(storeSelect.value, false);
      fetchData();
    });
    citySelect.addEventListener('change', () => {
      if(activeCountry !== 'canada') return;
      if(postalInput && !normalizePostal(postalInput.value)){
        updatePostalHelper(DEFAULT_POSTAL_MESSAGE, false);
      }
      fetchData();
    });
    range.addEventListener('input', render);
    if(searchInput){
      searchInput.addEventListener('input', () => {
        if(activeCountry !== 'canada') return;
        render();
      });
    }
    btnClear.addEventListener('click', async ()=>{
      if(activeCountry !== 'canada') return;
      const defaults = DEFAULT_FILTERS;
      if(searchInput){
        searchInput.value = defaults.search ?? '';
      }
      const defaultStore = getStoreByIdentifier(defaults.store);
      const defaultStoreValue = defaultStore?.slug || '';
      storeSelect.value = defaultStoreValue;
      setCityOptions(defaultStoreValue, false);
      if(citySelect){
        if(defaults.city){
          const options = Array.from(citySelect.options || []);
          citySelect.value = options.some(option => option.value === defaults.city) ? defaults.city : '';
        }else{
          citySelect.value='';
        }
      }
      range.value = defaults.discount ?? '0';
      resetPostalFilter();
      await fetchData();
    });

    // Startup
    await loadRonaDirectory();
    const defaultStore = getStoreByIdentifier(DEFAULT_FILTERS.store);
    const defaultStoreValue = defaultStore?.slug || '';
    if(searchInput){
      searchInput.value = DEFAULT_FILTERS.search ?? '';
    }
    storeSelect.value = defaultStoreValue;
    setCityOptions(defaultStoreValue, false);
    citySelect.value = DEFAULT_FILTERS.city;
    range.value = DEFAULT_FILTERS.discount; // ‚Üê 0% by default
    await fetchData();
  });
  </script>
</body>
</html>
