<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EconoDeal — Meilleurs rabais</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --panel-2:#1f2937; --text:#e5e7eb;
      --muted:#9ca3af; --accent:#22c55e; --border:#2b3446; --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#0b1020 50%,#0a0f1a);color:var(--text)}
    header{position:sticky;top:0;z-index:20;background:rgba(15,23,42,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .container{max-width:1100px;margin:0 auto;padding:18px}
    .row{display:flex;gap:16px;flex-wrap:wrap;align-items:center}
    .brand{display:inline-flex;align-items:center;gap:12px;padding:6px 14px;border-radius:14px;text-decoration:none;color:var(--text);background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.35);transition:transform .2s ease,box-shadow .2s ease,background .2s ease}
    .brand:hover{transform:translateY(-1px);box-shadow:0 12px 28px rgba(34,197,94,.15);background:rgba(34,197,94,.12)}
    .brand img{width:46px;height:46px;display:block}
    .brand-text{display:flex;flex-direction:column;line-height:1.1}
    .brand-title{margin:0;font-size:18px;font-weight:700;letter-spacing:-.01em}
    .brand-tagline{font-size:11px;text-transform:uppercase;letter-spacing:.14em;color:#86efac;font-weight:600}
    h2{margin:0;font-size:24px}
    .nav-button{display:inline-flex;align-items:center;justify-content:center;background:var(--panel-2);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 12px;text-decoration:none;transition:background .2s ease,color .2s ease}
    .nav-button:hover{background:var(--panel);color:#fff}
    .nav-button:focus{outline:2px solid var(--accent);outline-offset:1px}
    .nav-button.current{background:linear-gradient(120deg,rgba(34,197,94,.25),rgba(59,130,246,.25));border-color:rgba(34,197,94,.6)}
    .badge{display:inline-flex;gap:6px;align-items:center;background:rgba(34,197,94,.12);border:1px solid rgba(34,197,94,.35);color:#86efac;border-radius:999px;padding:6px 10px;font-weight:600;font-size:12px}
    .muted{color:var(--muted)}
    .section{padding:26px 0}
    .hero{display:grid;gap:12px}
    .filters{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-top:12px}
    select,button{background:var(--panel-2);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    select:focus,button:focus{outline:2px solid var(--accent);outline-offset:1px}
    button{cursor:pointer}
    button:disabled{opacity:.5;cursor:not-allowed}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px}
    .card{background:linear-gradient(180deg,var(--panel),#0e1626);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:140px;object-fit:cover;background:#0b0b10}
    .card .body{padding:12px;display:grid;gap:8px;flex:1}
    .card h3{margin:0;font-size:16px;line-height:1.4}
    .price{display:flex;gap:10px;align-items:baseline}
    .price .old{text-decoration:line-through;color:var(--muted)}
    .footer{border-top:1px solid var(--border);padding:20px 0;color:var(--muted);text-align:center}
    .status-banner{display:flex;gap:10px;align-items:center;background:rgba(59,130,246,.15);border:1px solid rgba(59,130,246,.35);color:#bfdbfe;padding:10px 12px;border-radius:10px;font-size:13px}
    .status-banner.error{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.4);color:#fecaca}
    .empty{border:1px dashed var(--border);padding:30px;border-radius:var(--radius);text-align:center;color:var(--muted)}
    @media (max-width:640px){
      header{position:static}
      .hero{gap:16px}
      .card img{height:180px}
    }
  </style>
</head>
<body class="overlay-active">
  <div id="registrationOverlay" role="dialog" aria-modal="true" aria-labelledby="registrationTitle">
    <div class="registration-card">
      <h2 id="registrationTitle">Accès réservé aux membres</h2>
      <p class="muted" style="margin:0">Rejoignez <strong><span data-client-count>0</span></strong> chasseurs de rabais et accédez au classement des meilleures offres.</p>
      <form id="registrationForm">
        <div>
          <label for="fullName">Nom complet</label>
          <input id="fullName" name="fullName" type="text" placeholder="Entrez votre nom" autocomplete="name" required />
        </div>
        <div>
          <label for="email">Courriel</label>
          <input id="email" name="email" type="email" placeholder="nom@exemple.com" autocomplete="email" required />
        </div>
        <div class="checkbox-row">
          <input id="regulationCheckbox" name="regulation" type="checkbox" required />
          <label for="regulationCheckbox" style="margin:0">Je confirme avoir lu et accepté les réglementations d'utilisation du site.</label>
        </div>
        <button id="registrationSubmit" type="submit" disabled>S'inscrire et accéder</button>
      </form>
    </div>
  </div>
  <header>
    <div class="container row" style="justify-content:space-between">
      <div class="row" style="gap:10px;align-items:center">
        <a class="brand" href="index.html">
          <img src="assets/logo.svg" alt="EconoDeal – accélérateur de revendeurs" />
          <span class="brand-text">
            <span class="brand-title">EconoDeal</span>
            <span class="brand-tagline">Revendeur gagnant</span>
          </span>
        </a>
      </div>
      <div class="row" style="gap:12px;align-items:center">
        <a class="nav-button current" href="best-deals.html" style="white-space:nowrap">Meilleurs rabais</a>
        <a class="nav-button" href="pricing.html" style="white-space:nowrap">Forfaits / prix</a>
        <a class="nav-button" href="roadmap.html" style="white-space:nowrap">Roadmap / vision</a>
        <div class="muted" style="white-space:nowrap">Clients inscrits&nbsp;: <span data-client-count>0</span></div>
        <div class="muted">© <span id="year"></span></div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="section" style="padding-bottom:10px">
      <div class="hero">
        <div class="badge">Mise à jour après chaque collecte</div>
        <h2>Classement des meilleures liquidations</h2>
        <p class="muted" style="max-width:720px">Découvrez les rabais les plus agressifs détectés par nos robots sur l'ensemble des détaillants surveillés. Le classement se rafraîchit automatiquement dès que les scrapers terminent leur collecte. Rechargez la page pour voir les dernières offres et consultez le top 100 des meilleures liquidations triées par pourcentage de rabais.</p>
        <div class="status-banner" id="statusBanner" role="status">
          <span id="statusText">Analyse des dernières collectes en cours...</span>
        </div>
        <div class="filters">
          <div>
            <label for="storeFilter" class="muted" style="font-size:12px;display:block;margin-bottom:4px">Filtrer par détaillant</label>
            <select id="storeFilter">
              <option value="">Tous les détaillants</option>
            </select>
          </div>
          <div style="margin-left:auto" class="muted">Total&nbsp;: <span id="dealCount">0</span> offres</div>
        </div>
      </div>
    </section>

    <section class="section" style="padding-top:12px">
      <div id="cards" class="grid" aria-live="polite"></div>
      <div id="emptyState" class="empty" style="display:none">Aucune liquidation trouvée pour le moment. Réessayez plus tard!</div>
    </section>
  </main>

  <div class="container footer">
    © <span id="yearFooter"></span> EconoDeal · Tous droits réservés
  </div>

  <style>
    /* Compléments stylistiques partagés avec l'accueil */
    #registrationOverlay{position:fixed;inset:0;background:rgba(15,23,42,.95);display:flex;align-items:center;justify-content:center;padding:20px;z-index:2000}
    #registrationOverlay.hidden{display:none}
    .registration-card{background:linear-gradient(180deg,var(--panel),#0e1626);border:1px solid var(--border);border-radius:var(--radius);max-width:420px;width:100%;padding:26px;display:grid;gap:16px;box-shadow:0 24px 60px rgba(15,23,42,.5)}
    .registration-card form{display:grid;gap:12px}
    .registration-card input{width:100%;background:var(--panel-2);color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    .registration-card button{background:linear-gradient(120deg,rgba(34,197,94,.9),rgba(59,130,246,.85));color:#fff;border:none;font-weight:600;cursor:pointer;transition:opacity .2s ease,transform .2s ease}
    .registration-card button:hover:not(:disabled){opacity:.9;transform:translateY(-1px)}
    .checkbox-row{display:flex;gap:10px;align-items:flex-start;background:rgba(34,197,94,.05);border:1px solid rgba(34,197,94,.3);padding:12px;border-radius:10px}
    body.overlay-active{overflow:hidden}
    body.overlay-active header,body.overlay-active main,body.overlay-active .footer{filter:blur(2px);pointer-events:none;user-select:none}
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const overlay = document.getElementById('registrationOverlay');
      const form = document.getElementById('registrationForm');
      const submitBtn = document.getElementById('registrationSubmit');
      const regulationCheckbox = document.getElementById('regulationCheckbox');
      const clientCountDisplays = Array.from(document.querySelectorAll('[data-client-count]'));
      const statusBanner = document.getElementById('statusBanner');
      const statusText = document.getElementById('statusText');
      const cardsEl = document.getElementById('cards');
      const emptyState = document.getElementById('emptyState');
      const storeFilter = document.getElementById('storeFilter');
      const dealCount = document.getElementById('dealCount');
      const year = document.getElementById('year');
      const yearFooter = document.getElementById('yearFooter');
      const currentYear = new Date().getFullYear();
      if(year) year.textContent = currentYear;
      if(yearFooter) yearFooter.textContent = currentYear;

      function parseJson(value){
        if(!value) return null;
        try{ return JSON.parse(value); }
        catch(err){ console.warn('Impossible de lire les données existantes', err); return null; }
      }
      function safeGet(key){
        try{ return localStorage.getItem(key); }
        catch(err){ console.warn('Stockage local indisponible', err); return null; }
      }
      function safeSet(key, value){
        try{ localStorage.setItem(key, value); }
        catch(err){ console.warn('Impossible d\'enregistrer les données', err); }
      }
      function cleanText(value){ return typeof value === 'string' ? value.trim() : ''; }
      function getRegistrations(){
        const parsed = parseJson(safeGet('econodealRegistrations'));
        if(!Array.isArray(parsed)) return [];
        return parsed
          .filter(item => item && typeof item === 'object')
          .map(item => ({
            name: cleanText(item.name),
            email: cleanText(item.email).toLowerCase(),
            registeredAt: cleanText(item.registeredAt)
          }))
          .filter(item => item.email);
      }
      function saveRegistrations(items){ safeSet('econodealRegistrations', JSON.stringify(items)); }
      function upsertRegistration(entry){
        const collection = getRegistrations();
        const email = cleanText(entry.email).toLowerCase();
        if(!email) return;
        const normalized = {
          name: cleanText(entry.name),
          email,
          registeredAt: cleanText(entry.registeredAt)
        };
        const existingIndex = collection.findIndex(item => item.email === email);
        if(existingIndex >= 0){ collection[existingIndex] = {...collection[existingIndex], ...normalized}; }
        else{ collection.push(normalized); }
        saveRegistrations(collection);
      }
      function parseCount(value){
        const parsed = parseInt(value ?? '0', 10);
        return Number.isFinite(parsed) && parsed >= 0 ? parsed : 0;
      }
      function setClientCount(value){
        const normalized = Math.max(0, value);
        safeSet('econodealClientCount', String(normalized));
        return normalized;
      }
      function deriveClientCountFromRegistrations(){
        const registrations = getRegistrations();
        if(!registrations.length) return 0;
        const uniqueEmails = new Set();
        registrations.forEach(item => {
          if(item?.email) uniqueEmails.add(item.email);
        });
        return uniqueEmails.size;
      }
      function resolveClientCount(){
        const stored = parseCount(safeGet('econodealClientCount'));
        const derived = deriveClientCountFromRegistrations();
        const resolved = Math.max(stored, derived);
        if(resolved !== stored){ setClientCount(resolved); }
        return resolved;
      }
      function updateClientCountDisplays(){
        const formatter = new Intl.NumberFormat('fr-CA');
        const count = resolveClientCount();
        clientCountDisplays.forEach(el => { el.textContent = formatter.format(count); });
      }
      function hideOverlay(){ if(!overlay) return; overlay.classList.add('hidden'); overlay.setAttribute('aria-hidden','true'); document.body.classList.remove('overlay-active'); }
      function showOverlay(){ if(!overlay) return; overlay.classList.remove('hidden'); overlay.removeAttribute('aria-hidden'); document.body.classList.add('overlay-active'); updateClientCountDisplays(); }
      resolveClientCount();
      updateClientCountDisplays();
      const alreadyRegistered = safeGet('econodealClientRegistered') === 'true';
      if(alreadyRegistered){ hideOverlay(); }
      else{ showOverlay(); }
      if(submitBtn && regulationCheckbox){
        submitBtn.disabled = !regulationCheckbox.checked;
        regulationCheckbox.addEventListener('change', () => { submitBtn.disabled = !regulationCheckbox.checked; });
      }
      if(form){
        form.addEventListener('submit', (event) => {
          event.preventDefault();
          if(!form.reportValidity()) return;
          const payload = {
            name: (form.fullName?.value ?? '').trim(),
            email: (form.email?.value ?? '').trim(),
            consent: true,
            registeredAt: new Date().toISOString()
          };
          safeSet('econodealUser', JSON.stringify(payload));
          upsertRegistration(payload);
          resolveClientCount();
          safeSet('econodealClientRegistered', 'true');
          updateClientCountDisplays();
          hideOverlay();
        });
      }

      window.addEventListener('storage', (event) => {
        if(!event) return;
        if(event.key === 'econodealRegistrations' || event.key === 'econodealClientCount'){
          updateClientCountDisplays();
        }
      });

      function baseBranches(){
        return [
          {label:'Montréal', slug:'montreal', city:'Montréal'},
          {label:'Laval', slug:'laval', city:'Laval'},
          {label:'Saint-Jérôme', slug:'saint-jerome', city:'Saint-Jérôme'}
        ];
      }
      function fullBestBuyBranches(){
        return [
          {label:'Anjou (1)', slug:'anjou', city:'Anjou'},
          {label:'Baie Comeau (1)', slug:'baie-comeau', city:'Baie-Comeau'},
          {label:'Beloeil (1)', slug:'beloeil', city:'Beloeil'},
          {label:'Brossard (1)', slug:'brossard', city:'Brossard'},
          {label:'Chomedey (2)', slug:'chomedey', city:'Chomedey'},
          {label:'Chateauguay (1)', slug:'chateauguay', city:'Chateauguay'},
          {label:'Chicoutimi (1)', slug:'chicoutimi', city:'Chicoutimi'},
          {label:'Drummondville (1)', slug:'drummondville', city:'Drummondville'},
          {label:'Gatineau (3)', slug:'gatineau', city:'Gatineau'},
          {label:'Granby (1)', slug:'granby', city:'Granby'},
          {label:'Joliette (1)', slug:'joliette', city:'Joliette'},
          {label:'LaSalle (1)', slug:'lasalle', city:'LaSalle'},
          {label:'Laval (2)', slug:'laval-best-buy', city:'Laval'},
          {label:'Longueuil (1)', slug:'longueuil', city:'Longueuil'},
          {label:'Mascouche (1)', slug:'mascouche', city:'Mascouche'},
          {label:'Montmagny (1)', slug:'montmagny', city:'Montmagny'},
          {label:'Montreal (2)', slug:'montreal-best-buy', city:'Montréal'},
          {label:'Pointe-Claire (2)', slug:'pointe-claire', city:'Pointe-Claire'},
          {label:'Quebec (4)', slug:'quebec', city:'Québec'},
          {label:'Rawdon (1)', slug:'rawdon', city:'Rawdon'},
          {label:'Repentigny (2)', slug:'repentigny', city:'Repentigny'},
          {label:'Rimouski (1)', slug:'rimouski', city:'Rimouski'},
          {label:'Riviere Du Loup (1)', slug:'riviere-du-loup', city:'Rivière-du-Loup'},
          {label:'Rosemere (1)', slug:'rosemere', city:'Rosemère'},
          {label:'Rouyn Noranda (1)', slug:'rouyn-noranda', city:'Rouyn-Noranda'},
          {label:'Saint-Eustache (1)', slug:'saint-eustache', city:'Saint-Eustache'},
          {label:'Saint-Hyacinthe (1)', slug:'saint-hyacinthe', city:'Saint-Hyacinthe'},
          {label:'Saint-Jean-sur-Richelieu (1)', slug:'saint-jean-sur-richelieu', city:'Saint-Jean-sur-Richelieu'},
          {label:'Saint-Jerome (1)', slug:'saint-jerome', city:'Saint-Jérôme'},
          {label:'Sainte-Marie (1)', slug:'sainte-marie', city:'Sainte-Marie'},
          {label:'Sept Iles (1)', slug:'sept-iles', city:'Sept-Îles'},
          {label:'Sherbrooke (1)', slug:'sherbrooke', city:'Sherbrooke'},
          {label:'St Georges (1)', slug:'st-georges', city:'Saint-Georges'},
          {label:'St Hyacinthe (1)', slug:'st-hyacinthe', city:'Saint-Hyacinthe'},
          {label:'St Jerome (1)', slug:'st-jerome', city:'Saint-Jérôme'},
          {label:'St-Bruno-de Montarville (1)', slug:'st-bruno-de-montarville', city:'Saint-Bruno-de-Montarville'},
          {label:'Terrebonne (1)', slug:'terrebonne', city:'Terrebonne'},
          {label:'Thetford Mines (1)', slug:'thetford-mines', city:'Thetford Mines'},
          {label:'Trois-Rivieres (1)', slug:'trois-rivieres', city:'Trois-Rivières'},
          {label:"Val-d'Or (1)", slug:'val-d-or', city:"Val-d'Or"},
          {label:'Vaudreuil-Dorion (1)', slug:'vaudreuil-dorion', city:'Vaudreuil-Dorion'},
          {label:'Victoriaville (1)', slug:'victoriaville', city:'Victoriaville'},
          {label:'Ville Mont Royal (1)', slug:'ville-mont-royal', city:'Mont-Royal'}
        ];
      }
      const WALMART_QUEBEC_BRANCHES = [
      {label: 'ST JEROME — Walmart #7147', slug: 'saint-jerome', city: 'St. Jerome', address: '1045 boul du grand heron, St. Jerome, QC, J7Y 3P2', distanceKm: 3.0, hasData: true},
      {label: 'BOISBRIAND — Walmart #7159', slug: 'boisbriand-7159', city: 'Boisbriand', address: '2400 boul de Faubourg, Boisbriand, QC, J7H 1S3', distanceKm: 20.7, hasData: false},
      {label: 'LAVAL — Walmart #7124', slug: 'laval', city: 'Laval', address: '1400 Le Corbusier Blvd., Laval, QC, H7N 6J5', distanceKm: 32.1, hasData: true},
      {label: 'ANJOU — Walmart #7156', slug: 'anjou-7156', city: 'Anjou', address: '11300, rue Renaude-Lapointe, Anjou, QC, H1J 2V7', distanceKm: 35.9, hasData: false},
      {label: 'L'ACADIE — Walmart #7146', slug: 'montreal', city: 'Montreal', address: '1000, rue Sauve Ouest, Montreal, QC, H4N 3L5', distanceKm: 37.4, hasData: true},
      {label: 'POINTE-CLAIRE — Walmart #7266', slug: 'pointe-claire-7266', city: 'Pointe-Claire', address: '185, boulevard Hymus, Pointe-Claire, QC, H9R 1E9', distanceKm: 38.0, hasData: false},
      {label: 'LACHENAIE — Walmart #7139', slug: 'lachenaie-7139', city: 'Lachenaie', address: '660 montee des Pionniers, Lachenaie, QC, J6V 1N9', distanceKm: 38.2, hasData: false},
      {label: 'BEAUBIEN OUEST — Walmart #7149', slug: 'beaubien-ouest-7149', city: 'Montreal', address: '100 rue Beaubien Ouest, Montreal, QC, H2S 3S1', distanceKm: 40.8, hasData: false},
      {label: 'VAUDREUIL — Walmart #7187', slug: 'vaudreuil-7187', city: 'Vaudreuil', address: '55 Boulevard de la Cite des Jeunes, Vaudreuil, QC, J7V 8C1', distanceKm: 42.4, hasData: false},
      {label: 'ST-HENRI — Walmart #7128', slug: 'st-henri-7128', city: 'Montreal', address: '4625 St-Antoine Ouest, Montreal, QC, H4C 1E2', distanceKm: 46.0, hasData: false},
      {label: 'GREENFIELD PARK — Walmart #7152', slug: 'greenfield-park-7152', city: 'Greenfield Park', address: '500 Auguste, Greenfield Park, QC, J4V 3R4', distanceKm: 52.8, hasData: false},
      {label: 'ST-CONSTANT — Walmart #7185', slug: 'st-constant-7185', city: 'St-Constant', address: '490 Voie de la desserte, St-Constant, QC, J5A 2S6', distanceKm: 54.8, hasData: false},
      {label: 'St Bruno — Walmart #7150', slug: 'st-bruno-7150', city: 'Saint-Bruno-de-Montarville', address: '901 Rue de l\'Étang, Saint-Bruno-de-Montarville, QC, J3V 6N8', distanceKm: 56.4, hasData: false},
      {label: 'ST JEAN — Walmart #7224', slug: 'st-jean-7224', city: 'St-Jean-sur-Richelieu', address: '850 RUE DOUGLAS, St-Jean-sur-Richelieu, QC, J3A 1V1', distanceKm: 74.5, hasData: false},
      {label: 'CORNWALL — Walmart #7075', slug: 'cornwall-7075', city: 'Cornwall', address: '1825 Brookdale Avenue, Cornwall, ON, K6J 5X7', distanceKm: 102.2, hasData: false},
      {label: 'GRANBY — Walmart #7188', slug: 'granby-7188', city: 'Ville de Granby', address: '165 rue Simonds Nord, Ville de Granby, QC, J2G 8C9', distanceKm: 104.8, hasData: false},
      {label: 'ORLEANS — Walmart #7118', slug: 'orleans-7118', city: 'Orleans', address: '2121 10th Line Road, Orleans, ON, K4A 4C5', distanceKm: 121.5, hasData: false},
      {label: 'TROIS RIVIERES — Walmart #7169', slug: 'trois-rivieres-7169', city: 'Trois Rivieres', address: '4500 Real-Proulx, Trois Rivieres, QC, G9A 6P9', distanceKm: 125.4, hasData: false},
      {label: 'GLOUCESTER — Walmart #7025', slug: 'gloucester-7025', city: 'Gloucester', address: '1616 Cyrville Road, Gloucester, ON, K1B 3L8', distanceKm: 132.0, hasData: false},
      {label: 'GATINEAU — Walmart #7140', slug: 'gatineau-7140', city: 'Gatineau', address: '243 montee Paiement, Gatineau, QC, J8P 6M7', distanceKm: 134.7, hasData: false},
      {label: 'SOUTH KEYS — Walmart #7158', slug: 'south-keys-7158', city: 'Ottawa', address: '2056 Bank St., Ottawa, ON, K1V 7Z8', distanceKm: 137.7, hasData: false},
      {label: 'NEPEAN — Walmart #7026', slug: 'nepean-7026', city: 'Ottawa', address: '1900 Baseline Road, Ottawa, ON, K2C 0C6', distanceKm: 145.4, hasData: false},
      {label: 'BARRHAVEN — Walmart #7079', slug: 'barrhaven-7079', city: 'Barrhaven', address: '3779 Strandherd Dr., Barrhaven, ON, K2J 5M4', distanceKm: 148.3, hasData: false},
      {label: 'KANATA — Walmart #7108', slug: 'kanata-7108', city: 'Kanata', address: '10 Frank Nighbor Place, Kanata, ON, K2T 1C4', distanceKm: 159.0, hasData: false},
      {label: 'SHERBROOKE — Walmart #7089', slug: 'sherbrooke-7089', city: 'Sherbrooke', address: '1355 boulevard du Plateau Saint-Joseph, Sherbrooke, QC, J1L 3E2', distanceKm: 162.8, hasData: false},
      {label: 'VICTORIAVILLE — Walmart #7087', slug: 'victoriaville-7087', city: 'Victoriaville', address: '160 boulevard Arthabaska Ouest, Victoriaville, QC, G6S 0P2', distanceKm: 163.5, hasData: false},
      {label: 'CARLETON PLACE — Walmart #7263', slug: 'carleton-place-7263', city: 'Carleton Place', address: '570 McNeely Avenue. Highway 7/McNelly Avenue, Carleton Place, ON, K7C 0A7', distanceKm: 181.0, hasData: false},
      {label: 'BROCKVILLE — Walmart #7085', slug: 'brockville-7085', city: 'Brockville', address: '2120 Parkdale Avenue, Brockville, ON, K6V 5T2', distanceKm: 184.7, hasData: false},
      {label: 'STE-FOY — Walmart #7163', slug: 'ste-foy-7163', city: 'Ste-Foy', address: '1516, rue Jules-Verne, Ste-Foy, QC, G2G 2R5', distanceKm: 231.7, hasData: false},
      {label: 'ST. ROMUALD — Walmart #7189', slug: 'st-romuald-7189', city: 'St-Romuald', address: '500 rue de la Concorde, St-Romuald, QC, G6W 8A8', distanceKm: 234.1, hasData: false},
      {label: 'PEMBROKE — Walmart #7242', slug: 'pembroke-7242', city: 'Pembroke', address: '27 Robinson Lane, Pembroke, ON, K8A 0A5', distanceKm: 239.0, hasData: false},
      {label: 'LEBOURGNEUF — Walmart #7162', slug: 'lebourgneuf-7162', city: 'Quebec', address: '300, rue Bouvier, Quebec, QC, G2J 1R8', distanceKm: 240.1, hasData: false},
      {label: 'KINGSTON — Walmart #7081', slug: 'kingston-7081', city: 'Kingston', address: '606, Gardiners Road, Kingston, ON, K7M 3X9', distanceKm: 265.0, hasData: false},
      {label: 'BELLEVILLE — Walmart #7133', slug: 'belleville-7133', city: 'Belleville', address: '210 Bell Boulevard, Belleville, ON, K8P 5H6', distanceKm: 321.9, hasData: false},
      {label: 'PETERBOROUGH — Walmart #7116', slug: 'peterborough-7116', city: 'Peterborough', address: '500 Lansdowne Street West, Peterborough, ON, K9J 8J7', distanceKm: 378.5, hasData: false},
      {label: 'COBOURG — Walmart #7251', slug: 'cobourg-7251', city: 'Cobourg', address: '1050 De Palma Drive, Cobourg, ON, K9A 0A8', distanceKm: 386.3, hasData: false},
      {label: 'HUNTSVILLE — Walmart #7244', slug: 'huntsville-7244', city: 'Huntsville', address: '9 Ott Drive, Huntsville, ON, P1H 0A2', distanceKm: 409.7, hasData: false},
      {label: 'BRACEBRIDGE — Walmart #7164', slug: 'bracebridge-7164', city: 'Bracebridge', address: '20 Depot Dr. RR 2, Bracebridge, ON, P1L 0A1', distanceKm: 421.2, hasData: false},
      {label: 'NORTH BAY — Walmart #7160', slug: 'north-bay-7160', city: 'North Bay', address: '1275 Seymour St., North Bay, ON, P1B 9V6', distanceKm: 424.3, hasData: false},
      {label: 'BOWMANVILLE — Walmart #7240', slug: 'bowmanville-7240', city: 'Bowmanville', address: '120 Clarington Boulevard, Bowmanville, ON, L1C 0C3', distanceKm: 425.9, hasData: false},
      {label: 'OSHAWA — Walmart #7123', slug: 'oshawa-7123', city: 'Oshawa', address: '1481 Harmony Rd. N., Oshawa, ON, L1K 0Z6', distanceKm: 434.0, hasData: false},
      {label: 'WHITBY — Walmart #7005', slug: 'whitby-7005', city: 'Whitby', address: '1700 Victoria Street E., Whitby, ON, L1N 9K6', distanceKm: 440.6, hasData: false},
      {label: 'WHITBY NORTH — Walmart #7249', slug: 'whitby-north-7249', city: 'Brooklin', address: '4200 Garden Street, Brooklin, ON, L1R 3K5', distanceKm: 441.9, hasData: false},
      {label: 'ORILLIA — Walmart #7137', slug: 'orillia-7137', city: 'Orillia', address: '3225 Monarch Dr., Orillia, ON, L3V 7Z4', distanceKm: 447.3, hasData: false},
      {label: 'AJAX — Walmart #7109', slug: 'ajax-7109', city: 'Ajax', address: '260 Kingston Road East, Ajax, ON, L1Z 1G1', distanceKm: 449.4, hasData: false},
      {label: 'PICKERING — Walmart #7238', slug: 'pickering-7238', city: 'Pickering', address: '1105-A Kingston Road, Pickering, ON, L1V 1B5', distanceKm: 457.4, hasData: false},
      {label: 'MARKHAM NORTH — Walmart #7262', slug: 'markham-north-7262', city: 'Markham', address: '1201 Castlemore Avenue, Markham, ON, L6E 0G5', distanceKm: 465.3, hasData: false},
      {label: 'MORNINGSIDE — Walmart #7027', slug: 'morningside-7027', city: 'Toronto', address: '60 Grand Marshall Drive, Toronto, ON, M1B 5N6', distanceKm: 465.7, hasData: false},
      {label: 'MARKHAM EAST — Walmart #7136', slug: 'markham-east-7136', city: 'Markham', address: '50 Kirkham Drive, Markham, ON, L3S 4K7', distanceKm: 466.9, hasData: false},
      {label: 'PARRY SOUND — Walmart #7226', slug: 'parry-sound-7226', city: 'Parry Sound', address: '100 Bowes Street, Parry Sound, ON, P2A 2L7', distanceKm: 471.1, hasData: false},
      {label: 'EGLINTON EAST — Walmart #7107', slug: 'eglinton-east-7107', city: 'Toronto', address: '2911 Eglinton Avenue East, Toronto, ON, M1J 2E5', distanceKm: 471.9, hasData: false},
      {label: 'NEWMARKET — Walmart #7030', slug: 'newmarket-7030', city: 'Newmarket', address: '17850 Yonge Street, Newmarket, ON, L3Y 8S1', distanceKm: 472.4, hasData: false},
      {label: 'AURORA — Walmart #7135', slug: 'aurora-7135', city: 'Aurora', address: '15360 Bayview Ave, Aurora, ON, L4G 7G1', distanceKm: 472.4, hasData: false},
      {label: 'MIDLAND — Walmart #7247', slug: 'midland-7247', city: 'Midland', address: '16775 Highway 12, Midland, ON, L4R 0A9', distanceKm: 474.2, hasData: false},
      {label: 'MARKHAM — Walmart #7004', slug: 'markham-7004', city: 'Markham', address: '3155 Highway #7, Markham, ON, L3R 0T9', distanceKm: 474.3, hasData: false},
      {label: 'RICHMOND HILL NORTH — Walmart #7161', slug: 'richmond-hill-north-7161', city: 'Richmond Hill', address: '1706 Elgin Mills Road East, Richmond Hill, ON, L4S 1M6', distanceKm: 474.3, hasData: false},
      {label: 'SCARBOROUGH — Walmart #7001', slug: 'scarborough-7001', city: 'Scarborough', address: '428 Ellesmere Road, Scarborough, ON, M1R 4E6', distanceKm: 474.9, hasData: false},
      {label: 'BARRIE — Walmart #7024', slug: 'barrie-7024', city: 'Barrie', address: '10 Barrie View Drive, Barrie, ON, L4M 4S7', distanceKm: 475.1, hasData: false},
      {label: 'BRADFORD — Walmart #7264', slug: 'bradford-7264', city: 'Bradford', address: '470 Holland Street West, Bradford, ON, L3Z 0A2', distanceKm: 477.8, hasData: false},
      {label: 'CURITY — Walmart #7012', slug: 'curity-7012', city: 'Toronto', address: '7 Curity Avenue, Toronto, ON, M4B 3L8', distanceKm: 479.0, hasData: false},
      {label: 'RICHMOND HILL — Walmart #7106', slug: 'richmond-hill-7106', city: 'Richmond Hill', address: '50, Red Maple Road, Richmond Hill, ON, L4B 4K1', distanceKm: 479.4, hasData: false},
      {label: 'LEASIDE — Walmart #7073', slug: 'leaside-7073', city: 'Toronto', address: '101, Wicksteed Ave., Toronto, ON, M4G 4H9', distanceKm: 482.4, hasData: false},
      {label: 'GERRARD SQUARE — Walmart #7080', slug: 'gerrard-square-7080', city: 'Toronto', address: '1000 Gerrard Street East, Toronto, ON, M4M 3G6', distanceKm: 483.1, hasData: false},
      {label: 'DUFFERIN — Walmart #7078', slug: 'dufferin-7078', city: 'Toronto', address: '2375 Steeles Avenue West, Toronto, ON, M3J 3N2', distanceKm: 486.5, hasData: false},
      {label: 'YORKDALE — Walmart #7129', slug: 'yorkdale-7129', city: 'Toronto', address: '90 Billy Bishop Way, Toronto, ON, M3K 2C8', distanceKm: 487.4, hasData: false},
      {label: 'VAUGHAN — Walmart #7253', slug: 'vaughan-7253', city: 'Vaughan', address: '55 Cityview Blvd, Vaughan, ON, L4H 4E8', distanceKm: 488.4, hasData: false},
      {label: 'CALEDONIA — Walmart #7134', slug: 'caledonia-7134', city: 'Toronto', address: '825 Caledonia Rd., Toronto, ON, M6B 3X8', distanceKm: 489.9, hasData: false},
      {label: 'WOODBRIDGE — Walmart #7002', slug: 'woodbridge-7002', city: 'Woodbridge', address: '140 Northview Blvd., Woodbridge, ON, L4L 8T2', distanceKm: 490.6, hasData: false},
      {label: 'STOCKYARDS — Walmart #7013', slug: 'stockyards-7013', city: 'Toronto', address: '2121 St. Clair Ave. West, Toronto, ON, M6N 5A8', distanceKm: 492.0, hasData: false},
      {label: 'REXDALE — Walmart #7114', slug: 'rexdale-7114', city: 'Etobicoke', address: '1983 Kipling Avenue, Etobicoke, ON, M9W 4J4', distanceKm: 496.6, hasData: false},
      {label: 'BOLTON — Walmart #7269', slug: 'bolton-7269', city: 'Bolton', address: '12760 Highway # 50, Bolton, ON, L7E 4G1', distanceKm: 499.0, hasData: false},
      {label: 'ETOBICOKE SOUTH — Walmart #7011', slug: 'etobicoke-south-7011', city: 'Etobicoke', address: '193 North Queen Street, Etobicoke, ON, M9C 1A7', distanceKm: 501.2, hasData: false},
      {label: 'NIAGARA FALLS — Walmart #7174', slug: 'niagara-falls-7174', city: 'Niagara Falls', address: '7190 Morrison Rd., Niagara Falls, ON, L2E 7K5', distanceKm: 503.5, hasData: false},
      {label: 'BRAMPTON EAST — Walmart #7239', slug: 'brampton-east-7239', city: 'Brampton', address: '9105 Airport Rd., Brampton, ON, L6S 0B8', distanceKm: 503.9, hasData: false},
      {label: 'ST. CATHARINES — Walmart #7023', slug: 'st-catharines-7023', city: 'St. Catharines', address: '20 YMCA Drive, St. Catharines, ON, L2N 7R6', distanceKm: 507.3, hasData: false},
      {label: 'BRAMPTON — Walmart #7006', slug: 'brampton-7006', city: 'Brampton', address: '49 First Gulf Boulevard, Brampton, ON, L6W 4R8', distanceKm: 508.8, hasData: false},
      {label: 'NORTH BRAMPTON — Walmart #7110', slug: 'north-brampton-7110', city: 'Brampton', address: '60, Great Lakes Drive, Brampton, ON, L6R 2K7', distanceKm: 509.2, hasData: false},
      {label: 'MISSISSAUGA SOUTH — Walmart #7112', slug: 'mississauga-south-7112', city: 'Mississauga', address: '3065, Mavis Road, Mississauga, ON, L5C 1T7', distanceKm: 509.3, hasData: false},
      {label: 'COLLINGWOOD — Walmart #7234', slug: 'collingwood-7234', city: 'Collingwood', address: '10 High Street, Collingwood, ON, L9Y 3J6', distanceKm: 509.7, hasData: false},
      {label: 'MISSISSAUGA BRITANNIA — Walmart #7132', slug: 'mississauga-britannia-7132', city: 'Mississauga', address: '5975 Terry Fox Way, Mississauga, ON, L5V 3E4', distanceKm: 511.7, hasData: false},
      {label: 'OAKVILLE — Walmart #7003', slug: 'oakville-7003', city: 'Oakville', address: '2555 Bristol Circle, Oakville, ON, L6H 5W9', distanceKm: 515.5, hasData: false},
      {label: 'BRAMPTON WEST — Walmart #7301', slug: 'brampton-west-7301', city: 'Brampton', address: '9515 Mississauga Rd, Brampton, ON, L6X 0B3', distanceKm: 517.1, hasData: false},
      {label: 'MISSISSAUGA WEST — Walmart #7130', slug: 'mississauga-west-7130', city: 'Mississauga', address: '2920 Argentia Road, Mississauga, ON, L5N 8C5', distanceKm: 517.5, hasData: false},
      {label: 'TRAFALGAR VILLAGE — Walmart #7157', slug: 'trafalgar-village-7157', city: 'Oakville', address: '99 Cross Ave., Oakville, ON, L6J 2W7', distanceKm: 519.5, hasData: false},
      {label: 'ORANGEVILLE — Walmart #7167', slug: 'orangeville-7167', city: 'Orangeville', address: '49 Fourth Avenue, Orangeville, ON, L9W 1G7', distanceKm: 523.1, hasData: false},
      {label: 'OAKVILLE BURLOAK — Walmart #7115', slug: 'oakville-burloak-7115', city: 'Oakville', address: '3300 South Service Road West, Oakville, ON, L6L 0B1', distanceKm: 526.9, hasData: false},
      {label: 'MILTON — Walmart #7241', slug: 'milton-7241', city: 'Milton', address: '1013 Maple Avenue, Milton, ON, L9T 0A5', distanceKm: 527.4, hasData: false},
      {label: 'BURLINGTON — Walmart #7021', slug: 'burlington-7021', city: 'Burlington', address: '3050 Davidson Court, Burlington, ON, L7M 4M9', distanceKm: 533.6, hasData: false},
      {label: 'HAMILTON — Walmart #7008', slug: 'hamilton-7008', city: 'Hamilton', address: '350 Centennial Parkway N., Hamilton, ON, L8E 2X4', distanceKm: 537.2, hasData: false},
      {label: 'SUDBURY — Walmart #7022', slug: 'sudbury-7022', city: 'Sudbury', address: '1500 Marcus Drive, Sudbury, ON, P3B 4K5', distanceKm: 541.1, hasData: false},
      {label: 'HAMILTON MOUNTAIN — Walmart #7256', slug: 'hamilton-mountain-7256', city: 'Stoney Creek', address: '1775 Stone Church Road East, Stoney Creek, ON, L8J 0B4', distanceKm: 543.8, hasData: false},
      {label: 'ANCASTER — Walmart #7007', slug: 'ancaster-7007', city: 'Ancaster', address: '122 Martindale Crescent, Ancaster, ON, L9K 1J9', distanceKm: 550.4, hasData: false},
      {label: 'GUELPH — Walmart #7142', slug: 'guelph-7142', city: 'Guelph', address: '63 Woodlawn Road West, Guelph, ON, N1H 1G8', distanceKm: 554.8, hasData: false},
      {label: 'OWEN SOUND — Walmart #7154', slug: 'owen-sound-7154', city: 'Owen Sound', address: '1590 20th Avenue East, Owen Sound, ON, N4K 5N3', distanceKm: 558.8, hasData: false},
      {label: 'CAMBRIDGE — Walmart #7166', slug: 'cambridge-7166', city: 'Cambridge', address: '35 Pine Bush Drive, Cambridge, ON, N1R 8E2', distanceKm: 566.3, hasData: false},
      {label: 'FREDERICTON — Walmart #7233', slug: 'fredericton-7233', city: 'Fredericton', address: '1450 Regent St., Fredericton, NB, E3C 0A4', distanceKm: 567.7, hasData: false},
      {label: 'KITCHENER — Walmart #7017', slug: 'kitchener-7017', city: 'Kitchener', address: '100 Gateway Park Drive, Kitchener, ON, N2P 2J4', distanceKm: 570.9, hasData: false},
      {label: 'BRANTFORD — Walmart #7138', slug: 'brantford-7138', city: 'Brantford', address: '25 Holiday Dr., Brantford, ON, N3R 7J4', distanceKm: 574.5, hasData: false},
      {label: 'WATERLOO — Walmart #7105', slug: 'waterloo-7105', city: 'Waterloo', address: '600 King Street North, Waterloo, ON, N2V 2J5', distanceKm: 575.9, hasData: false},
      {label: 'KITCHENER WEST — Walmart #7179', slug: 'kitchener-west-7179', city: 'Kitchener', address: '1450 Ottawa Street South, Kitchener, ON, N2E 4E2', distanceKm: 579.2, hasData: false},
      {label: 'WOODSTOCK — Walmart #7182', slug: 'woodstock-7182', city: 'Woodstock', address: '901 Juliana Drive, Woodstock, ON, N4V 1B9', distanceKm: 611.3, hasData: false},
      {label: 'SAINT JOHN — Walmart #7103', slug: 'saint-john-7103', city: 'Saint John', address: '55 Depot Court, Saint John, NB, E2J 5E5', distanceKm: 622.7, hasData: false},
      {label: 'TIMMINS — Walmart #7236', slug: 'timmins-7236', city: 'Timmins', address: '2143 Riverside Drive, Timmins, ON, P4N 7C3', distanceKm: 635.2, hasData: false},
      {label: 'LONDON EAST — Walmart #7237', slug: 'london-east-7237', city: 'London', address: '448 Clarke Road, London, ON, N5W 6H1', distanceKm: 648.5, hasData: false},
      {label: 'NORTH LONDON — Walmart #7009', slug: 'north-london-7009', city: 'London', address: '600 Fanshawe Park Road East, London, ON, N5X 1L1', distanceKm: 652.3, hasData: false},
      {label: 'LONDON SW — Walmart #7033', slug: 'london-sw-7033', city: 'London', address: '3035 Wonderland Road South, London, ON, N6L 1R4', distanceKm: 659.7, hasData: false},
      {label: 'MONCTON — Walmart #7148', slug: 'moncton-7148', city: 'Moncton', address: '235 Mapleton Rd., Moncton, NB, E1C 0G9', distanceKm: 709.4, hasData: false},
      {label: 'SARNIA — Walmart #7153', slug: 'sarnia-7153', city: 'Sarnia', address: '1350 Quinn Drive, Sarnia, ON, N7S 6L5', distanceKm: 733.1, hasData: false},
      {label: 'NEW MINAS — Walmart #7261', slug: 'new-minas-7261', city: 'New Minas', address: '21 Silver Fox Ave, New Minas, NS, B4N 0C9', distanceKm: 745.3, hasData: false},
      {label: 'CHATHAM — Walmart #7178', slug: 'chatham-7178', city: 'Chatham', address: '8582 Pioneer Line RR1, Chatham, ON, N7M 5J1', distanceKm: 754.7, hasData: false},
      {label: 'SAULT STE-MARIE — Walmart #7034', slug: 'sault-ste-marie-7034', city: 'Sault Ste-Marie', address: '530 Great Northern Road, Sault Ste-Marie, ON, P6B 4Z9', distanceKm: 799.2, hasData: false},
      {label: 'WINDSOR EAST — Walmart #7184', slug: 'windsor-east-7184', city: 'Windsor', address: '6570 - 6630 Tecumseh Road East, Windsor, ON, N8T 1E6', distanceKm: 811.9, hasData: false},
      {label: 'WINDSOR — Walmart #7228', slug: 'windsor-7228', city: 'Windsor', address: '1925 Division Road, Windsor, ON, N8W 1Z7', distanceKm: 817.0, hasData: false},
      {label: 'HALIFAX — Walmart #7126', slug: 'halifax-7126', city: 'Halifax', address: '368 Lacewood Dr., Halifax, NS, B3S 1L8', distanceKm: 817.5, hasData: false},
      {label: 'DARTMOUTH CROSSING — Walmart #7257', slug: 'dartmouth-crossing-7257', city: 'Dartmouth', address: '40 Finnian Row, Dartmouth, NS, B3B 0B6', distanceKm: 824.7, hasData: false},
      {label: 'CHARLOTTETOWN — Walmart #7173', slug: 'charlottetown-7173', city: 'Charlottetown', address: '60 Buchanan Dr., Charlottetown, PE, C1E 2E4', distanceKm: 838.1, hasData: false},
      {label: 'SYDNEY — Walmart #7151', slug: 'sydney-7151', city: 'Sydney', address: '50 Sydney Port Access Road, Sydney, NS, B1P 7H2', distanceKm: 1068.1, hasData: false},
      {label: 'THUNDER BAY — Walmart #7102', slug: 'thunder-bay-7102', city: 'Thunder Bay', address: '359 Main St., Thunder Bay, ON, P7B 5L6', distanceKm: 1188.3, hasData: false},
      {label: 'ST. JOHN'S — Walmart #7077', slug: 'st-john-s-7077', city: 'St. John\'s', address: '70 Kelsey Drive, St. John\'s, NL, A1B 5C7', distanceKm: 1625.5, hasData: false},
      {label: 'CROSSROADS — Walmart #7056', slug: 'crossroads-7056', city: 'Winnipeg', address: '1590, Regent Ave., Winnipeg, MB, R2C 3B4', distanceKm: 1774.0, hasData: false},
      {label: 'ST. VITAL (WINNIPEG SOUTH) — Walmart #7058', slug: 'st-vital-winnipeg-south-7058', city: 'Winnipeg', address: '1999 Bishop Grandin Blvd., Winnipeg, MB, R2M 3E8', distanceKm: 1775.4, hasData: false},
      {label: 'WINNIPEG NORTH — Walmart #7180', slug: 'winnipeg-north-7180', city: 'Winnipeg', address: '845 Leila Ave., Winnipeg, MB, R2V 3J7', distanceKm: 1780.2, hasData: false},
      {label: 'WINNIPEG SW — Walmart #7086', slug: 'winnipeg-sw-7086', city: 'Winnipeg', address: '1645 Kenaston Blvd., Winnipeg, MB, R3P 2M4', distanceKm: 1782.8, hasData: false},
      {label: 'WINNIPEG POLO PARK — Walmart #7057', slug: 'winnipeg-polo-park-7057', city: 'Winnipeg', address: '727 Empress Street, Winnipeg, MB, R3G 3P5', distanceKm: 1783.1, hasData: false},
      {label: 'BRANDON — Walmart #7038', slug: 'brandon-7038', city: 'Brandon', address: '801-18th Street North, Brandon, MB, R7A 7S1', distanceKm: 1980.8, hasData: false},
      {label: 'REGINA — Walmart #7052', slug: 'regina-7052', city: 'Regina', address: '1867 Victoria Avenue East, Regina, SK, S4N 6E6', distanceKm: 2310.0, hasData: false},
      {label: 'REGINA NW — Walmart #7245', slug: 'regina-nw-7245', city: 'Regina', address: '1030 North Pasqua Street, Regina, SK, S4X 4V3', distanceKm: 2316.1, hasData: false},
      {label: 'SASKATOON SOUTH — Walmart #7265', slug: 'saskatoon-south-7265', city: 'Saskatoon', address: '3043 Clarence Avenue South, Saskatoon, SK, S7T 0B5', distanceKm: 2462.6, hasData: false},
      {label: 'SASKATOON — Walmart #7051', slug: 'saskatoon-7051', city: 'Saskatoon', address: '707 Circle Dr. East, Saskatoon, SK, S7K 0V1', distanceKm: 2463.8, hasData: false},
      {label: 'LLOYDMINSTER — Walmart #7258', slug: 'lloydminster-7258', city: 'Lloydminster', address: '7705 44th Street, Lloydminster, AB, T9V 0X9', distanceKm: 2700.5, hasData: false},
      {label: 'MEDICINE HAT — Walmart #7036', slug: 'medicine-hat-7036', city: 'Medicine Hat', address: '1851 Strachan Rd. East, Medicine Hat, AB, T1B 4V7', distanceKm: 2744.6, hasData: false},
      {label: 'LETHBRIDGE — Walmart #7170', slug: 'lethbridge-7170', city: 'Lethbridge', address: '3708 Mayor Magrath Dr. S., Lethbridge, AB, T1K 7V1', distanceKm: 2901.4, hasData: false},
      {label: 'FORT SASKATCHEWAN — Walmart #7222', slug: 'fort-saskatchewan-7222', city: 'Fort Saskatchewan', address: '9280 Southfort Drive, Fort Saskatchewan, AB, T8L 0C5', distanceKm: 2910.8, hasData: false},
      {label: 'SHERWOOD PARK — Walmart #7172', slug: 'sherwood-park-7172', city: 'Sherwood Park', address: '200, 390 Baseline Rd., Sherwood Park, AB, T8H 1X1', distanceKm: 2915.8, hasData: false},
      {label: 'EDMONTON E. (WHITEMUD) — Walmart #7248', slug: 'edmonton-e-whitemud-7248', city: 'Edmonton', address: '4430-17th Street NW, Edmonton, AB, T6T 0B4', distanceKm: 2920.3, hasData: false},
      {label: 'CLAREVIEW (EDMONTON) — Walmart #7062', slug: 'clareview-edmonton-7062', city: 'Edmonton', address: '13304-50th Street N.W., Edmonton, AB, T5A 4Z8', distanceKm: 2923.6, hasData: false},
      {label: 'EDMONTON S. (SOUTH COMMON) — Walmart #7065', slug: 'edmonton-s-south-common-7065', city: 'Edmonton', address: '2020-101 Street N.W., Edmonton, AB, T6N 1J2', distanceKm: 2928.0, hasData: false},
      {label: 'EDMONTON STRATHCONA — Walmart #7117', slug: 'edmonton-strathcona-7117', city: 'Edmonton', address: '6725 104th Street N.W., Edmonton, AB, T6H 2L3', distanceKm: 2928.9, hasData: false},
      {label: 'EDMONTON SKYVIEW — Walmart #7119', slug: 'edmonton-skyview-7119', city: 'Edmonton', address: '13360 - 137th Avenue N.W., Edmonton, AB, T5L 5C7', distanceKm: 2932.6, hasData: false},
      {label: 'EDMONTON WESTMOUNT — Walmart #7227', slug: 'edmonton-westmount-7227', city: 'Edmonton', address: '604-1 Westmount Shopping Centre Circle NWC 111th Avenue, Edmonton, AB, T5M 3L7', distanceKm: 2933.9, hasData: false},
      {label: 'EDMONTON WINDERMERE — Walmart #7268', slug: 'edmonton-windermere-7268', city: 'EDMONTON', address: '6218 Currents Drive NW, EDMONTON, AB, T6W 0L8', distanceKm: 2935.9, hasData: false},
      {label: 'EDMONTON W. (WESTEND) — Walmart #7064', slug: 'edmonton-w-westend-7064', city: 'Edmonton', address: '17404-99th Ave. N.W., Edmonton, AB, T5T 5L5', distanceKm: 2937.0, hasData: false},
      {label: 'ST. ALBERT — Walmart #7088', slug: 'st-albert-7088', city: 'St. Albert', address: '750 St. Albert Road, St. Albert, AB, T8N 7H5', distanceKm: 2937.8, hasData: false},
      {label: 'RED DEER — Walmart #7131', slug: 'red-deer-7131', city: 'Red Deer', address: '2030 50th Avenue, Red Deer, AB, T4R 3A2', distanceKm: 2951.5, hasData: false},
      {label: 'SPRUCE GROVE — Walmart #7050', slug: 'spruce-grove-7050', city: 'Spruce Grove', address: '180 Hwy. 16A, Spruce Grove, AB, T7X 3X3', distanceKm: 2957.1, hasData: false},
      {label: 'AIRDRIE — Walmart #7254', slug: 'airdrie-7254', city: 'Airdrie', address: '2925 Main Street West, Airdrie, AB, T4B 3G5', distanceKm: 2970.3, hasData: false},
      {label: 'CALGARY SOUTHEAST (MACKENZIE) — Walmart #7082', slug: 'calgary-southeast-mackenzie-7082', city: 'Calgary', address: '5125 126th Avenue SE, Calgary, AB, T2Z 0B2', distanceKm: 2970.3, hasData: false},
      {label: 'CALGARY NORTHEAST (MARLBOROUGH) — Walmart #7061', slug: 'calgary-northeast-marlborough-7061', city: 'Calgary', address: '343-36th Street N.E., Calgary, AB, T2A 7S9', distanceKm: 2970.5, hasData: false},
      {label: 'OKOTOKS — Walmart #7223', slug: 'okotoks-7223', city: 'Okotoks', address: '10-101 Southbank Boulevard, Okotoks, AB, T1S 0G1', distanceKm: 2971.5, hasData: false},
      {label: 'CALGARY COUNTRY HILLS — Walmart #7111', slug: 'calgary-country-hills-7111', city: 'Calgary', address: '388 Country Hills Boulevard, Calgary, AB, T3K 5H2', distanceKm: 2975.4, hasData: false},
      {label: 'CALGARY CHINOOK — Walmart #7063', slug: 'calgary-chinook-7063', city: 'Calgary', address: '6500 MacLeod Trail S.W., Calgary, AB, T2H 0K6', distanceKm: 2977.2, hasData: false},
      {label: 'SHAWNESSY (CALGARY SOUTH) — Walmart #7067', slug: 'shawnessy-calgary-south-7067', city: 'Calgary', address: '390 Shawville Blvd. S.E., Calgary, AB, T2Y 3S4', distanceKm: 2977.5, hasData: false},
      {label: 'CALGARY NORTH HILL — Walmart #7037', slug: 'calgary-north-hill-7037', city: 'Calgary', address: '1818 16th Ave N.W., Calgary, AB, T2M 0L8', distanceKm: 2978.8, hasData: false},
      {label: 'CALGARY BEACON HILL — Walmart #7076', slug: 'calgary-beacon-hill-7076', city: 'Calgary', address: '11320 Sarcee Trail NW, Calgary, AB, T3R 0A1', distanceKm: 2982.2, hasData: false},
      {label: 'CALGARY (TUSCANY) — Walmart #7250', slug: 'calgary-tuscany-7250', city: 'Calgary', address: '5019 Nose Hill Drive N. W., Calgary, AB, T3L 0A2', distanceKm: 2987.2, hasData: false},
      {label: 'CRANBROOK — Walmart #7255', slug: 'cranbrook-7255', city: 'Cranbrook', address: '2000 McPhee Road, Cranbrook, BC, V1C 0A3', distanceKm: 3114.7, hasData: false},
      {label: 'GRANDE PRAIRIE — Walmart #7175', slug: 'grande-prairie-7175', city: 'Grande Prairie', address: '11222 - 103 Ave., Grande Prairie, AB, T8V 7H1', distanceKm: 3275.1, hasData: false},
      {label: 'VERNON — Walmart #7084', slug: 'vernon-7084', city: 'Vernon', address: '5501 Anderson Way, Vernon, BC, V1T 9V1', distanceKm: 3350.1, hasData: false},
      {label: 'KELOWNA — Walmart #7032', slug: 'kelowna-7032', city: 'Kelowna', address: '2515 Enterprise Way, Kelowna, BC, V1X 7K2', distanceKm: 3369.4, hasData: false},
      {label: 'WESTBANK — Walmart #7252', slug: 'westbank-7252', city: 'Westbank', address: '3550 Carrington Road, Unit #401, Westbank, BC, V4T 2Z1', distanceKm: 3383.4, hasData: false},
      {label: 'KAMLOOPS — Walmart #7144', slug: 'kamloops-7144', city: 'Kamloops', address: '1020 Hillside Dr, Kamloops, BC, V2E 2S5', distanceKm: 3420.7, hasData: false},
      {label: 'PRINCE GEORGE — Walmart #7171', slug: 'prince-george-7171', city: 'Prince George', address: '5959 O\'Grady Road, Prince George, BC, V2N 6Z5', distanceKm: 3537.4, hasData: false},
      {label: 'CHILLIWACK # — Walmart #7273', slug: 'chilliwack-7273', city: 'Chilliwack', address: '100 - 8443 Eagle Landing Parkway, Chilliwack, BC, V2P 0E2', distanceKm: 3565.7, hasData: false},
      {label: 'ABBOTSFORD — Walmart #7141', slug: 'abbotsford-7141', city: 'Abbotsford', address: '1956 Vedder Way, Abbotsford, BC, V2S 8K1', distanceKm: 3589.2, hasData: false},
      {label: 'LANGLEY — Walmart #7041', slug: 'langley-7041', city: 'Langley', address: '6550-200th St., Langley, BC, V2Y 1P2', distanceKm: 3615.3, hasData: false},
      {label: 'PORT COQUITLAM — Walmart #7145', slug: 'port-coquitlam-7145', city: 'Port Coquitlam', address: '1069 Nicola Drive, Port Coquitlam, BC, V3B 8B2', distanceKm: 3617.3, hasData: false},
      {label: 'COQUITLAM — Walmart #7045', slug: 'coquitlam-7045', city: 'Coquitlam', address: '1900 United Blvd., Coquitlam, BC, V3K 6Z1', distanceKm: 3624.8, hasData: false},
      {label: 'SURREY (WHITEROCK) — Walmart #7122', slug: 'surrey-whiterock-7122', city: 'Surrey', address: '2525-160th Street, Surrey, BC, V3Z 0C8', distanceKm: 3625.0, hasData: false},
      {label: 'SURREY — Walmart #7046', slug: 'surrey-7046', city: 'Surrey', address: '12701-110th Avenue, Surrey, BC, V3V 3J7', distanceKm: 3627.6, hasData: false},
      {label: 'Surrey (Strawberry Hill) — Walmart #7044', slug: 'surrey-strawberry-hill-7044', city: 'Surrey', address: '7350-120th Street, Surrey, BC, V3W 3M9', distanceKm: 3630.6, hasData: false},
      {label: 'SQUAMISH — Walmart #7053', slug: 'squamish-7053', city: 'Squamish', address: '39251 Discovery Way, Squamish, BC, V8B 0M9', distanceKm: 3634.8, hasData: false},
      {label: 'BURNABY — Walmart #7047', slug: 'burnaby-7047', city: 'Burnaby', address: '3950 Henning Dr, Burnaby, BC, V5C 6M2', distanceKm: 3636.4, hasData: false},
      {label: 'VANCOUVER — Walmart #7042', slug: 'vancouver-7042', city: 'Vancouver', address: '900 Terminal Ave., Vancouver, BC, V6A 4G4', distanceKm: 3641.0, hasData: false},
      {label: 'RICHMOND — Walmart #7043', slug: 'richmond-7043', city: 'Richmond', address: '2700 Sweden Way, Richmond, BC, V6V 2W8', distanceKm: 3642.8, hasData: false},
      {label: 'VANCOUVER CAMBIE — Walmart #7259', slug: 'vancouver-cambie-7259', city: 'Vancouver', address: '2388 Cambie Street, Vancouver, BC, V5Z 2T8', distanceKm: 3643.4, hasData: false},
      {label: 'PARK ROYAL — Walmart #7035', slug: 'park-royal-7035', city: 'West Vancouver', address: '840 Main St., Park Royal Village, West Vancouver, BC, V7T 2Z3', distanceKm: 3643.4, hasData: false},
      {label: 'VICTORIA DOWNTOWN — Walmart #7055', slug: 'victoria-downtown-7055', city: 'Saanich', address: '3986 Shelbourne Street, Saanich, BC, V8N 3E3', distanceKm: 3679.7, hasData: false},
      {label: 'VICTORIA — Walmart #7074', slug: 'victoria-7074', city: 'Victoria', address: '2400 Millstream Road, Victoria, BC, V9B 3R3', distanceKm: 3691.7, hasData: false},
      {label: 'DUNCAN — Walmart #7272', slug: 'duncan-7272', city: 'Duncan', address: '1-2980 Drinkwater Road, Duncan, BC, V9L 6C6', distanceKm: 3698.2, hasData: false},
      {label: 'NANAIMO — Walmart #7040', slug: 'nanaimo-7040', city: 'Nanaimo', address: '6555 Metral Street, Nanaimo, BC, V9T 2L9', distanceKm: 3710.0, hasData: false},
      {label: 'COURTENAY — Walmart #7177', slug: 'courtenay-7177', city: 'Courtenay', address: '388 Lerwick Rd., Courtenay, BC, V9N 9E5', distanceKm: 3762.3, hasData: false},
      {label: 'CAMPBELL RIVER — Walmart #7221', slug: 'campbell-river-7221', city: 'Campbell River', address: '1482 Island Highway, Campbell River, BC, V9W 8C9', distanceKm: 3774.7, hasData: false},
      {label: 'Online — Walmart #7274', slug: 'online-7274', city: 'Online', address: '', distanceKm: 8774.6, hasData: false}
    ];

      const STORES = [
        {label:'Best Buy', slug:'best-buy', branches: fullBestBuyBranches()},
        {label:'Home Depot', slug:'home-depot', branches: baseBranches()},
        {label:'Walmart', slug:'walmart', branches: WALMART_QUEBEC_BRANCHES},
        {label:'Canadian Tire', slug:'canadian-tire', branches: baseBranches()},
        {label:'Rona', slug:'rona', branches: baseBranches()},
        {label:'Patrick Morin', slug:'patrick-morin', branches: baseBranches()},
        {label:'Sporting Life', slug:'sporting-life', branches: baseBranches()}
      ];

      function slugify(value){
        if(value === undefined || value === null) return '';
        const text = String(value).normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        return text.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'').replace(/--+/g,'-');
      }
      function firstDefined(...values){
        for(const value of values){ if(value !== undefined && value !== null && value !== '') return value; }
        return null;
      }
      function toNumber(value){
        if(typeof value === 'number' && Number.isFinite(value)) return value;
        if(typeof value === 'string' && value.trim()){
          const parsed = Number(value.replace(/[^0-9,.-]/g,'').replace(',','.'));
          return Number.isFinite(parsed) ? parsed : null;
        }
        return null;
      }
      function normalizeDeal(item, storeLabel, branch){
        const branchLabel = typeof branch === 'object' && branch ? branch.label : branch;
        const branchSlug = typeof branch === 'object' && branch && branch.slug ? branch.slug : slugify(branchLabel || item.city || storeLabel);
        const cityLabel = typeof branch === 'object' && branch && branch.city ? branch.city : firstDefined(item.city, branchLabel, storeLabel);
        const citySlug = slugify(cityLabel);
        const regular = toNumber(firstDefined(item.original_price, item.originalPrice, item.regular_price, item.regularPrice, item.price_before, item.priceBefore, item.listPrice, item.price));
        const sale = toNumber(firstDefined(item.salePrice, item.sale_price, item.discount_price, item.discountPrice, item.current_price, item.currentPrice, item.price));
        const finalRegular = regular ?? sale ?? 0;
        const finalSale = sale ?? regular ?? 0;
        return {
          title: firstDefined(item.title, item.name, 'Article en liquidation'),
          image: firstDefined(item.image, item.image_url, item.imageUrl, item.img, 'https://via.placeholder.com/400x300?text=Liquidation'),
          price: finalRegular,
          salePrice: finalSale,
          store: item.store ?? storeLabel,
          city: item.city ?? cityLabel,
          branch: branchLabel ?? cityLabel,
          branchSlug,
          citySlug,
          url: firstDefined(item.url, item.link, '#')
        };
      }
      function discount(p,s){
        const price = Number(p);
        const sale = Number(s);
        if(!Number.isFinite(price) || price <= 0) return 0;
        if(!Number.isFinite(sale)) return 0;
        const clampedSale = Math.max(0, sale);
        const pct = Math.round((1 - (clampedSale / price)) * 100);
        return Number.isFinite(pct) ? Math.max(pct, 0) : 0;
      }
      function currency(n){ return Number.isFinite(n) ? n.toLocaleString('fr-CA',{style:'currency',currency:'CAD'}) : '—'; }
      function filePathFor(store, branch){
        const s = store?.slug;
        const c = typeof branch === 'object' ? branch?.slug : branch;
        if(!s || !c) return null;
        return `data/${s}/${c}.json`;
      }

      async function loadCanadianTireDirectory(){
        const store = STORES.find(entry => entry.slug === 'canadian-tire');
        if(!store) return;
        try{
          const res = await fetch('data/canadian-tire/stores.json', {cache:'no-store'});
          if(!res.ok) return;
          const json = await res.json();
          if(!Array.isArray(json)) return;
          const seen = new Map();
          for(const branch of store.branches ?? []){
            seen.set(branch.slug, {...branch, hasData:true});
          }
          for(const entry of json){
            if(!entry || typeof entry !== 'object') continue;
            const rawSlug = typeof entry.slug === 'string' && entry.slug ? entry.slug : slugify(entry.nickname || entry.city || entry.label);
            if(!rawSlug) continue;
            const label = (entry.nickname || (entry.label || '').replace(/^Canadian Tire\s*/i, '') || entry.city || rawSlug).trim();
            const city = entry.city || label;
            seen.set(rawSlug, {label, slug: rawSlug, city});
          }
          store.branches = Array.from(seen.values()).sort((a,b)=>a.label.localeCompare(b.label,'fr'));
        }catch(err){
          console.warn('Impossible de charger les succursales Canadian Tire', err);
        }
      }

      async function fetchOne(path, storeLabel, branch){
        try{
          const res = await fetch(path, {cache:'no-store'});
          if(!res.ok) return {entries:[], updatedAt:null};
          let updatedAt = null;
          const lastModified = res.headers?.get?.('Last-Modified');
          if(lastModified){
            const parsed = Date.parse(lastModified);
            if(Number.isFinite(parsed)) updatedAt = parsed;
          }
          const json = await res.json();
          if(!Array.isArray(json)) return {entries:[], updatedAt};
          return {
            entries: json.map(item => normalizeDeal(item, storeLabel, branch)),
            updatedAt
          };
        }catch(error){
          console.warn('fetch fail', path, error);
          return {entries:[], updatedAt:null};
        }
      }

      let allDeals = [];
      function render(){
        const filter = storeFilter.value;
        const subset = filter ? allDeals.filter(deal => deal.store === filter) : allDeals;
        const sorted = subset
          .map(deal => ({...deal, discountPct: discount(deal.price, deal.salePrice)}))
          .filter(deal => deal.discountPct > 0)
          .sort((a,b) => {
            if(b.discountPct !== a.discountPct) return b.discountPct - a.discountPct;
            return (a.salePrice ?? Number.POSITIVE_INFINITY) - (b.salePrice ?? Number.POSITIVE_INFINITY);
          });
        const top = sorted.slice(0, 100);
        dealCount.textContent = top.length.toString();
        if(top.length === 0){
          cardsEl.innerHTML = '';
          emptyState.style.display = '';
          return;
        }
        emptyState.style.display = 'none';
        cardsEl.innerHTML = top.map(deal => `
          <article class="card">
            <img src="${deal.image}" alt="${deal.title}" loading="lazy" />
            <div class="body">
              <div class="badge">-${deal.discountPct}% Rabais</div>
              <h3>${deal.title}</h3>
              <div class="muted">${deal.store} · ${deal.branch ?? deal.city ?? ''}</div>
              <div class="price"><div class="old">${currency(deal.price)}</div><div>${currency(deal.salePrice)}</div></div>
              <a class="nav-button" href="${deal.url || '#'}" target="_blank" rel="noopener" style="justify-content:center;width:100%">Voir l'offre</a>
            </div>
          </article>`).join('');
      }

      async function fetchAllDeals(){
        statusBanner.classList.remove('error');
        statusText.textContent = 'Analyse des dernières collectes en cours...';
        const tasks = [];
        for(const store of STORES){
          const branches = store.branches ?? [];
          for(const branch of branches){
            const path = filePathFor(store, branch);
            if(path) tasks.push({store, branch, path});
          }
        }
        const seen = new Set();
        const aggregated = [];
        let latestUpdated = 0;
        for(const task of tasks){
          if(seen.has(task.path)) continue;
          seen.add(task.path);
          const {entries, updatedAt} = await fetchOne(task.path, task.store.label, task.branch);
          for(const entry of entries){ aggregated.push(entry); }
          if(updatedAt && updatedAt > latestUpdated){ latestUpdated = updatedAt; }
        }
        return {deals: aggregated, lastUpdated: latestUpdated || null};
      }

      function populateStoreFilter(){
        const options = ['<option value="">Tous les détaillants</option>'];
        for(const store of STORES){
          options.push(`<option value="${store.label}">${store.label}</option>`);
        }
        storeFilter.innerHTML = options.join('');
      }

      populateStoreFilter();
      storeFilter.addEventListener('change', render);

      await loadCanadianTireDirectory();
      try{
        const result = await fetchAllDeals();
        allDeals = result.deals;
        let displayDate;
        if(result.lastUpdated){
          displayDate = new Date(result.lastUpdated);
        }else{
          displayDate = new Date();
        }
        statusText.textContent = `Dernière collecte analysée le ${displayDate.toLocaleString('fr-CA', {dateStyle:'medium', timeStyle:'short'})}`;
      }catch(err){
        console.error('Impossible de récupérer les liquidations', err);
        statusText.textContent = "Erreur lors du chargement des liquidations.";
        statusBanner.classList.add('error');
      }
      render();
    });
  </script>
</body>
</html>
